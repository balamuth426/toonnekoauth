 // Se√ßilen seriyi d√ºzenleme formuna y√ºkle
        async function loadSeriesForEdit() {
            const seriesId = document.getElementById('edit-series-select').value;
            const formContainer = document.getElementById('edit-series-form-container');
            
            if (!seriesId) {
                formContainer.style.display = 'none';
                return;
            }

            try {
                const response = await fetch('http://localhost:5506/client/data/manhwalar.json');
                const series = await response.json();
                const selectedSeries = series.find(s => s.seriesId === seriesId);

                if (!selectedSeries) {
                    showStatus('Seri bulunamadƒ±', 'error');
                    return;
                }

                // Form alanlarƒ±nƒ± doldur
                document.getElementById('edit-series-title').value = selectedSeries.title || '';
                document.getElementById('edit-series-status').value = selectedSeries.status || 'Devam Ediyor';
                document.getElementById('edit-series-summary').value = selectedSeries.summary || '';
                document.getElementById('edit-series-cover').value = selectedSeries.image || '';
                document.getElementById('edit-series-author').value = selectedSeries.author || '';
                document.getElementById('edit-series-artist').value = selectedSeries.artist || '';
                document.getElementById('edit-series-publisher').value = selectedSeries.publisher || '';
                
                // Genres array'ini virg√ºlle ayrƒ±lmƒ±≈ü string'e √ßevir
                const genresString = selectedSeries.genres ? selectedSeries.genres.join(', ') : '';
                document.getElementById('edit-series-genres').value = genresString;

                // Etiket bilgilerini y√ºkle
                const label = selectedSeries.label;
                let labelStatus = 'none'; // Varsayƒ±lan: Etiket yok
                
                if (label) {
                    if (label.enabled === true) {
                        labelStatus = 'true'; // Etiketi g√∂ster
                    } else if (label.enabled === false) {
                        labelStatus = 'false'; // Etiketi gizle
                    }
                    // Etiket var ise text ve color'ƒ± y√ºkle
                    document.getElementById('edit-series-label-text').value = label.text || 'Yeni';
                    document.getElementById('edit-series-label-color').value = label.color || '#4CAF50';
                } else {
                    // Etiket yok ise varsayƒ±lan deƒüerler
                    document.getElementById('edit-series-label-text').value = 'Yeni';
                    document.getElementById('edit-series-label-color').value = '#4CAF50';
                }
                
                document.getElementById('edit-series-label-enabled').value = labelStatus;
                toggleLabelSettings();

                // Kapak √∂nizlemesini g√∂ster
                if (selectedSeries.image) {
                    document.getElementById('edit-preview-image').src = selectedSeries.image;
                    document.getElementById('edit-cover-preview').style.display = 'block';
                }

                formContainer.style.display = 'block';
            } catch (error) {
                console.error('Seri y√ºklenirken hata:', error);
                showStatus('Seri bilgileri y√ºklenemedi', 'error');
            }
        }

        // Kapak g√∂rselini doƒürula (d√ºzenleme formu i√ßin)
        function validateEditCoverImage() {
            const url = document.getElementById('edit-series-cover').value;
            const previewContainer = document.getElementById('edit-cover-preview');
            const previewImage = document.getElementById('edit-preview-image');

            if (!url) {
                showStatus('L√ºtfen bir g√∂rsel URL\'si girin', 'error');
                previewContainer.style.display = 'none';
                return;
            }

            // Google Drive linkini proxy URL'ye d√∂n√º≈üt√ºr
            let imageUrl = url;
            const driveMatch = url.match(/\/file\/d\/([a-zA-Z0-9_-]+)/);
            if (driveMatch) {
                const fileId = driveMatch[1];
                imageUrl = `http://localhost:5506/api/image/proxy-image/${fileId}`;
            }

            // Loading g√∂ster
            previewImage.src = '';
            previewContainer.style.display = 'block';
            previewImage.style.display = 'none';
            
            // Temporary loading message
            const loadingMsg = document.createElement('div');
            loadingMsg.innerHTML = 'üîÑ G√∂rsel y√ºkleniyor...';
            loadingMsg.style.padding = '20px';
            loadingMsg.style.textAlign = 'center';
            loadingMsg.id = 'temp-loading';
            previewContainer.appendChild(loadingMsg);

            previewImage.onload = function() {
                const tempLoading = document.getElementById('temp-loading');
                if (tempLoading) tempLoading.remove();
                
                previewImage.style.display = 'block';
                showStatus('G√∂rsel ba≈üarƒ±yla y√ºklendi', 'success');
            };
            
            previewImage.onerror = function() {
                const tempLoading = document.getElementById('temp-loading');
                if (tempLoading) tempLoading.remove();
                
                previewContainer.style.display = 'none';
                showStatus('G√∂rsel y√ºklenemedi. URL\'yi kontrol edin', 'error');
            };
            
            previewImage.src = imageUrl;
        }

        // D√ºzenleme formunu temizle ve gizle
        function cancelEdit() {
            document.getElementById('edit-series-select').value = '';
            document.getElementById('edit-series-form-container').style.display = 'none';
            document.getElementById('edit-cover-preview').style.display = 'none';
            document.getElementById('edit-series-form').reset();
        }

        // Seri d√ºzenleme form submit
        document.getElementById('edit-series-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const seriesId = document.getElementById('edit-series-select').value;
            if (!seriesId) {
                showStatus('L√ºtfen bir seri se√ßin', 'error');
                return;
            }

            // Loading g√∂ster
            showLoading(true);
            
            // Status mesajƒ±nƒ± temizle
            const statusDiv = document.getElementById('status-message');
            statusDiv.style.display = 'none';

            try {
                // Form verilerini manuel olarak topla
                const editData = {
                    seriesId: seriesId,
                    title: document.getElementById('edit-series-title').value,
                    status: document.getElementById('edit-series-status').value,
                    summary: document.getElementById('edit-series-summary').value,
                    image: document.getElementById('edit-series-cover').value,
                    author: document.getElementById('edit-series-author').value,
                    artist: document.getElementById('edit-series-artist').value,
                    publisher: document.getElementById('edit-series-publisher').value,
                    genres: document.getElementById('edit-series-genres').value.split(',').map(g => g.trim()).filter(g => g)
                };

                // Etiket i≈üleme
                const labelValue = document.getElementById('edit-series-label-enabled').value;
                if (labelValue === 'none') {
                    // Etiket tamamen kaldƒ±r
                    editData.removeLabel = true;
                } else {
                    // Etiket ekle/g√ºncelle
                    editData.label = {
                        enabled: labelValue === 'true',
                        text: document.getElementById('edit-series-label-text').value,
                        color: document.getElementById('edit-series-label-color').value
                    };
                }

                // Zorunlu alanlarƒ± kontrol et
                if (!editData.title || !editData.status || !editData.image) {
                    showLoading(false);
                    showStatus('L√ºtfen t√ºm zorunlu alanlarƒ± doldurun (Ba≈ülƒ±k, Durum, Kapak G√∂rseli)', 'error');
                    return;
                }

                // Google Drive linkini proxy URL'ye d√∂n√º≈üt√ºr
                const driveMatch = editData.image.match(/\/file\/d\/([a-zA-Z0-9_-]+)/);
                if (driveMatch) {
                    const fileId = driveMatch[1];
                    editData.image = `http://localhost:5506/api/image/proxy-image/${fileId}`;
                }

                console.log('G√∂nderilen veri:', editData); // Debug i√ßin

                const response = await fetch('http://localhost:5506/api/manhwa/edit', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(editData)
                });

                const result = await response.json();
                console.log('Sunucu yanƒ±tƒ±:', result); // Debug i√ßin

                if (response.ok) {
                    showStatus('Seri ba≈üarƒ±yla g√ºncellendi!', 'success');
                    // Edit sekmesindeki seri listesini yenile
                    loadEditSeriesList();
                    // Se√ßili seriyi yeniden y√ºkle
                    loadSeriesForEdit();
                } else {
                    showStatus(result.error || 'Seri g√ºncellenirken hata olu≈ütu', 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showStatus('Beklenmeyen bir hata olu≈ütu: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        });

        // G√∂rsel URL alanƒ±nda deƒüi≈üiklik olduƒüunda otomatik √∂nizleme
        document.getElementById('edit-series-cover').addEventListener('input', function() {
            // 1 saniye bekle sonra otomatik doƒürula
            clearTimeout(this.previewTimeout);
            this.previewTimeout = setTimeout(() => {
                if (this.value.trim()) {
                    validateEditCoverImage();
                }
            }, 1000);
        });

        // Seri se√ßimi deƒüi≈ütiƒüinde onay kontrol√º
        document.getElementById('delete-series').addEventListener('change', function() {
            const confirmText = document.getElementById('confirm-delete').value.toUpperCase();
            const deleteBtn = document.getElementById('delete-btn');
            
            if (confirmText === 'Sƒ∞L' && this.value) {
                deleteBtn.disabled = false;
                deleteBtn.style.opacity = '1';
            } else {
                deleteBtn.disabled = true;
                deleteBtn.style.opacity = '0.5';
            }
        });

        // ===== KULLANICI Y√ñNETƒ∞Mƒ∞ FONKSƒ∞YONLARI =====
        
        let allUsers = [];

        // Kullanƒ±cƒ±larƒ± y√ºkle
        async function loadUsers() {
            try {
                console.log('Kullanƒ±cƒ±larƒ± y√ºklemeye √ßalƒ±≈üƒ±yor...');

                // Test endpoint kullan (ge√ßici √ß√∂z√ºm)
                const response = await fetch('http://localhost:5506/api/admin/test-users', {
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                console.log('Response status:', response.status);
                console.log('Response ok:', response.ok);

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('Server error response:', errorText);
                    throw new Error(`Server error ${response.status}: ${errorText}`);
                }

                const data = await response.json();
                console.log('Response data:', JSON.stringify(data, null, 2));
                
                // API direkt kullanƒ±cƒ± array'i d√∂nd√ºr√ºyor
                if (Array.isArray(data)) {
                    allUsers = data;
                    renderUsers(allUsers);
                    updateUserStats(allUsers);
                } else if (data.success) {
                    allUsers = data.users;
                    renderUsers(allUsers);
                    updateUserStats(allUsers);
                } else {
                    throw new Error(data.error || data.details || 'Kullanƒ±cƒ±lar y√ºklenemedi');
                }
            } catch (error) {
                console.error('Kullanƒ±cƒ±larƒ± y√ºkleme hatasƒ±:', error);
                document.getElementById('users-loading').innerHTML = `
                    <div style="color: #dc3545; font-size: 16px;">
                        ‚ùå Kullanƒ±cƒ±lar y√ºklenemedi: ${error.message}
                        <br><small>Detaylar i√ßin tarayƒ±cƒ± console'unu kontrol edin.</small>
                    </div>
                `;
            }
        }

        // Kullanƒ±cƒ± istatistiklerini g√ºncelle
        function updateUserStats(users) {
            const totalUsers = users.length;
            const adminUsers = users.filter(u => u.isAdmin).length;
            const moderatorUsers = users.filter(u => u.isModerator).length;
            const blockedUsers = users.filter(u => u.isBlocked).length;

            document.getElementById('total-users-count').textContent = totalUsers;
            document.getElementById('admin-users-count').textContent = adminUsers;
            document.getElementById('moderator-users-count').textContent = moderatorUsers;
            document.getElementById('blocked-users-count').textContent = blockedUsers;
        }

        // Kullanƒ±cƒ±larƒ± render et
        function renderUsers(users) {
            const container = document.getElementById('users-list');
            const loadingDiv = document.getElementById('users-loading');
            
            loadingDiv.style.display = 'none';
            container.style.display = 'block';

            if (users.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #666; padding: 40px;">Kullanƒ±cƒ± bulunamadƒ±</div>';
                return;
            }

            const usersHTML = users.map(user => {
                const statusBadges = [];
                if (user.isAdmin) statusBadges.push('<span style="background: #28a745; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px; margin-left: 8px;">Admin</span>');
                if (user.isModerator) statusBadges.push('<span style="background: #ffc107; color: black; padding: 4px 8px; border-radius: 12px; font-size: 12px; margin-left: 8px;">Moderat√∂r</span>');
                if (user.isBlocked) statusBadges.push('<span style="background: #dc3545; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px; margin-left: 8px;">Engelli</span>');
                
                return `
                    <div class="user-card" style="background: #f8f9fa; border-radius: 10px; padding: 20px; margin-bottom: 15px; border-left: 4px solid ${user.isAdmin ? '#28a745' : user.isModerator ? '#ffc107' : user.isBlocked ? '#dc3545' : '#667eea'};">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h4 style="margin-bottom: 8px;">
                                    üë§ ${user.username}
                                    ${statusBadges.join('')}
                                </h4>
                                <p style="color: #666; margin-bottom: 8px;">üìß ${user.email}</p>
                                <div style="font-size: 14px; color: #888;">
                                    <span>üìÖ Kayƒ±t: ${new Date(user.createdAt).toLocaleDateString('tr-TR')}</span>
                                    <span style="margin-left: 20px;">‚≠ê ${user.ratings ? user.ratings.length : 0} puan</span>
                                    <span style="margin-left: 20px;">‚ù§Ô∏è ${user.favorites ? user.favorites.length : 0} favori</span>
                                    <span style="margin-left: 20px;">üìñ ${user.readSeries ? user.readSeries.length : 0} okunan</span>
                                    ${user.isModerator ? `<span style="margin-left: 20px;">üõ°Ô∏è ${user.moderatorSeries ? user.moderatorSeries.length : 0} seri</span>` : ''}
                                </div>
                            </div>
                            <div style="display: flex; gap: 10px;">
                                <button onclick="viewUserDetails('${user._id}')" style="background: #17a2b8; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer;">üëÅÔ∏è Detay</button>
                                <button onclick="toggleUserAdmin('${user._id}', ${!user.isAdmin})" 
                                        style="background: ${user.isAdmin ? '#6c757d' : '#28a745'}; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer;">
                                    ${user.isAdmin ? 'üë§ Admin Al' : '‚≠ê Admin Yap'}
                                </button>
                                <button onclick="toggleUserBlock('${user._id}', ${!user.isBlocked})" 
                                        style="background: ${user.isBlocked ? '#28a745' : '#ffc107'}; color: ${user.isBlocked ? 'white' : 'black'}; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer;">
                                    ${user.isBlocked ? '‚úÖ Engel Kaldƒ±r' : 'üö´ Engelle'}
                                </button>
                                <button onclick="deleteUser('${user._id}', '${user.username}')" style="background: #dc3545; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer;">üóëÔ∏è Sil</button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = usersHTML;
        }

        // Kullanƒ±cƒ± arama
        function filterUsers() {
            const searchTerm = document.getElementById('user-search').value.toLowerCase();
            const filteredUsers = allUsers.filter(user => 
                user.username.toLowerCase().includes(searchTerm) || 
                user.email.toLowerCase().includes(searchTerm)
            );
            renderUsers(filteredUsers);
        }

        // Admin yetkisi deƒüi≈ütir - GE√áƒ∞Cƒ∞ MOCK
        async function toggleUserAdmin(userId, makeAdmin) {
            if (!confirm(`Bu kullanƒ±cƒ±yƒ± ${makeAdmin ? 'admin yapmak' : 'admin yetkisini almak'} istediƒüinizden emin misiniz?`)) {
                return;
            }

            try {
                // GE√áƒ∞Cƒ∞: Mock response d√∂nd√ºr
                console.log(`üîß Mock i≈ülem: Kullanƒ±cƒ± ${userId} ${makeAdmin ? 'admin yapƒ±ldƒ±' : 'admin yetkisi kaldƒ±rƒ±ldƒ±'}`);
                alert(`Kullanƒ±cƒ± ${makeAdmin ? 'admin yapƒ±ldƒ±' : 'admin yetkisi kaldƒ±rƒ±ldƒ±'} (Mock i≈ülem)`);
                await loadUsers(); // Listeyi yenile
            } catch (error) {
                console.error('Mock admin i≈ülemi hatasƒ±:', error);
                alert('Hata: ' + error.message);
            }
        }

        // Kullanƒ±cƒ± engelleme - GE√áƒ∞Cƒ∞ MOCK
        async function toggleUserBlock(userId, blockUser) {
            if (!confirm(`Bu kullanƒ±cƒ±yƒ± ${blockUser ? 'engellemek' : 'engel kaldƒ±rmak'} istediƒüinizden emin misiniz?`)) {
                return;
            }

            try {
                // GE√áƒ∞Cƒ∞: Mock response d√∂nd√ºr
                console.log(`üîß Mock i≈ülem: Kullanƒ±cƒ± ${userId} ${blockUser ? 'engellendi' : 'engeli kaldƒ±rƒ±ldƒ±'}`);
                alert(`Kullanƒ±cƒ± ${blockUser ? 'engellendi' : 'engeli kaldƒ±rƒ±ldƒ±'} (Mock i≈ülem)`);
                await loadUsers(); // Listeyi yenile
            } catch (error) {
                console.error('Mock block i≈ülemi hatasƒ±:', error);
                alert('Hata: ' + error.message);
            }
        }

        // Kullanƒ±cƒ± silme - GE√áƒ∞Cƒ∞ MOCK
        async function deleteUser(userId, username) {
            if (!confirm(`"${username}" kullanƒ±cƒ±sƒ±nƒ± kalƒ±cƒ± olarak silmek istediƒüinizden emin misiniz?\n\nBu i≈ülem geri alƒ±namaz!`)) {
                return;
            }

            try {
                // GE√áƒ∞Cƒ∞: Mock response d√∂nd√ºr
                console.log(`üîß Mock i≈ülem: Kullanƒ±cƒ± ${username} (${userId}) silindi`);
                alert(`Kullanƒ±cƒ± "${username}" silindi (Mock i≈ülem)`);
                await loadUsers(); // Listeyi yenile
                await loadUsers(); // Listeyi yenile
            } catch (error) {
                console.error('Mock silme i≈ülemi hatasƒ±:', error);
                alert('Hata: ' + error.message);
            }
        }

        // Kullanƒ±cƒ± detaylarƒ±nƒ± g√∂r√ºnt√ºle
        async function viewUserDetails(userId) {
            try {
                // allUsers array'inden kullanƒ±cƒ±yƒ± bul
                const user = allUsers.find(u => u._id === userId);
                
                if (!user) {
                    throw new Error('Kullanƒ±cƒ± bulunamadƒ±');
                }
                
                const modalContent = document.getElementById('user-detail-content');
                    
                    modalContent.innerHTML = `
                        <div style="margin-bottom: 20px;">
                            <h4>üë§ ${user.username}</h4>
                            <p><strong>üìß E-posta:</strong> ${user.email}</p>
                            <p><strong>üìÖ Kayƒ±t Tarihi:</strong> ${new Date(user.createdAt).toLocaleString('tr-TR')}</p>
                            <p><strong>üîÑ Son G√ºncelleme:</strong> ${new Date(user.updatedAt).toLocaleString('tr-TR')}</p>
                            <p><strong>üïê Son Giri≈ü:</strong> ${user.lastLoginAt ? new Date(user.lastLoginAt).toLocaleString('tr-TR') : 'Bilinmiyor'}</p>
                            <p><strong>‚≠ê Admin:</strong> ${user.isAdmin ? '‚úÖ Evet' : '‚ùå Hayƒ±r'}</p>
                            <p><strong>ÔøΩÔ∏è Moderat√∂r:</strong> ${user.isModerator ? '‚úÖ Evet' : '‚ùå Hayƒ±r'}</p>
                            ${user.isModerator && user.moderatorSeries ? `<p><strong>üìö Atanmƒ±≈ü Seriler:</strong> ${user.moderatorSeries.length} seri</p>` : ''}
                            <p><strong>ÔøΩüö´ Engelli:</strong> ${user.isBlocked ? '‚úÖ Evet' : '‚ùå Hayƒ±r'}</p>
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <h5>üìä Kullanƒ±cƒ± Aktivitesi</h5>
                            <p><strong>‚≠ê Verilen Puanlar:</strong> ${user.ratings ? user.ratings.length : 0}</p>
                            <p><strong>‚ù§Ô∏è Favoriler:</strong> ${user.favorites ? user.favorites.length : 0}</p>
                            <p><strong>üìñ Okunan Seriler:</strong> ${user.readSeries ? user.readSeries.length : 0}</p>
                            <p><strong>üìà Okuma ƒ∞lerlemesi:</strong> ${user.readingProgress ? user.readingProgress.length : 0} seri</p>
                        </div>
                        
                        ${user.favorites && user.favorites.length > 0 ? `
                            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                                <h5>‚ù§Ô∏è Favori Seriler</h5>
                                <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px;">
                                    ${user.favorites.map(fav => `<span style="background: #667eea; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px;">${fav}</span>`).join('')}
                                </div>
                            </div>
                        ` : ''}
                    `;
                    
                    // Moderat√∂r y√∂netimi b√∂l√ºm√ºn√º g√∂ster (admin olmayan kullanƒ±cƒ±lar i√ßin)
                    const moderatorSection = document.getElementById('moderator-assignment-section');
                    if (!user.isAdmin) {
                        moderatorSection.style.display = 'block';
                        // √ñnce serileri y√ºkle, sonra moderat√∂r atamasƒ±nƒ± ayarla
                        await loadSeriesForUserModeratorAssignment();
                        setupModeratorAssignment(user);
                    } else {
                        moderatorSection.style.display = 'none';
                    }
                    
                    document.getElementById('user-detail-modal').style.display = 'block';
            } catch (error) {
                alert('Kullanƒ±cƒ± detaylarƒ± y√ºklenemedi: ' + error.message);
            }
        }

        // Modal kapatma
        function closeUserModal() {
            document.getElementById('user-detail-modal').style.display = 'none';
        }

        // Tab deƒüi≈ütiƒüinde kullanƒ±cƒ±larƒ± y√ºkle
        const originalSwitchTab = switchTab;
        switchTab = function(tabName) {
            originalSwitchTab(tabName);
            if (tabName === 'users') {
                loadUsers();
                loadSeriesForUserModeratorAssignment();
            }
            if (tabName === 'moderators') {
                loadModerators();
                loadSeriesForModeratorAssignment();
            }
        };

        // Sayfa y√ºklendiƒüinde giri≈ü kontrol√º
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Admin panel loading...');
            
            // URL parametresi ile localStorage temizleme
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('clear') === 'true') {
                localStorage.clear();
                console.log('localStorage cleared');
            }
            
            // Debug: localStorage durumunu kontrol et
            const currentToken = localStorage.getItem('token');
            console.log('Current token:', currentToken);
            
            // Eƒüer token yoksa veya ge√ßersizse giri≈ü formu g√∂ster
            if (!currentToken) {
                console.log('No token found, showing login form');
                document.querySelector('.admin-container').style.display = 'none';
                showLoginForm();
            } else {
                console.log('Token found, verifying...');
                // Token'ƒ± verify et
                verifyToken(currentToken);
            }

            // Etiket ayarlarƒ± event listener'larƒ±
            const labelTextSelect = document.getElementById('edit-series-label-text');
            const labelColorSelect = document.getElementById('edit-series-label-color');
            
            if (labelTextSelect) {
                labelTextSelect.addEventListener('change', updateLabelPreview);
            }
            if (labelColorSelect) {
                labelColorSelect.addEventListener('change', updateLabelPreview);
            }
        });
        
        // Token doƒürulama fonksiyonu
        async function verifyToken(token) {
            try {
                const response = await fetch('http://localhost:5506/api/admin/test-users', {
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    console.log('Token valid, showing admin panel');
                    document.querySelector('.admin-container').style.display = 'block';
                } else {
                    console.log('Token invalid, clearing and showing login');
                    localStorage.removeItem('token');
                    document.querySelector('.admin-container').style.display = 'none';
                    showLoginForm();
                }
            } catch (error) {
                console.log('Token verification failed:', error);
                localStorage.removeItem('token');
                document.querySelector('.admin-container').style.display = 'none';
                showLoginForm();
            }
        }

        // Yorum Y√∂netimi Fonksiyonlarƒ±
        let currentReportsPage = 1;
        let currentCommentsPage = 1;

        // Rapor istatistiklerini y√ºkle
        async function loadReportsStats() {
            try {
                const response = await fetch(`${API_BASE}/reports/admin/stats`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                
                if (response.ok) {
                    const stats = await response.json();
                    document.getElementById('pending-reports').textContent = stats.pendingReports;
                    document.getElementById('total-reports').textContent = stats.totalReports;
                    document.getElementById('reported-comments').textContent = stats.reportedComments;
                }
            } catch (error) {
                console.error('Stats y√ºklenirken hata:', error);
            }
        }

        // Raporlarƒ± y√ºkle
        async function loadReports(page = 1) {
            try {
                const status = document.getElementById('report-status-filter').value;
                const seriesId = document.getElementById('series-filter').value;
                
                const params = new URLSearchParams({
                    page,
                    status,
                    limit: 10
                });
                
                if (seriesId) params.append('seriesId', seriesId);
                
                const response = await fetch(`${API_BASE}/reports/admin/reports?${params}`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    renderReports(data.reports);
                    renderReportsPagination(data.page, data.totalPages);
                    currentReportsPage = data.page;
                }
            } catch (error) {
                console.error('Raporlar y√ºklenirken hata:', error);
            }
        }

        // Raporlarƒ± render et
        function renderReports(reports) {
            const listDiv = document.getElementById('reports-list');
            
            if (reports.length === 0) {
                listDiv.innerHTML = '<p style="text-align: center; color: #666;">Rapor bulunamadƒ±.</p>';
                return;
            }

            listDiv.innerHTML = reports.map(report => `
                <div class="report-item" style="border: 1px solid #ddd; border-radius: 8px; padding: 20px; margin-bottom: 15px; background: white;">
                    <div style="display: flex; justify-content: between; align-items: start; margin-bottom: 15px;">
                        <div style="flex: 1;">
                            <h4 style="margin: 0 0 8px 0; color: #333;">
                                ${report.seriesTitle} - ${report.replyId ? 'Yanƒ±t' : 'Yorum'}
                                <span class="report-status status-${report.status}" style="
                                    padding: 4px 8px; 
                                    border-radius: 4px; 
                                    font-size: 0.8rem; 
                                    margin-left: 10px;
                                    background: ${getStatusColor(report.status)};
                                    color: white;
                                ">${getStatusText(report.status)}</span>
                            </h4>
                            <p style="margin: 5px 0; color: #666; font-size: 0.9rem;">
                                <strong>Rapor Eden:</strong> ${report.reportedBy} | 
                                <strong>Neden:</strong> ${getReasonText(report.reason)} | 
                                <strong>Tarih:</strong> ${new Date(report.reportDate).toLocaleString('tr-TR')}
                            </p>
                            ${report.description ? `<p style="margin: 5px 0; color: #666;"><strong>A√ßƒ±klama:</strong> ${report.description}</p>` : ''}
                        </div>
                    </div>
                    
                    ${report.commentId ? `
                        <div style="background: #f9f9f9; padding: 15px; border-radius: 6px; margin: 15px 0;">
                            <p style="margin: 0; font-size: 0.9rem;"><strong>Yorum ƒ∞√ßeriƒüi:</strong></p>
                            <p style="margin: 5px 0 0 0; font-style: italic;">${report.commentId.text || 'Yorum i√ßeriƒüi y√ºklenemedi'}</p>
                            <p style="margin: 5px 0 0 0; font-size: 0.8rem; color: #666;">
                                <strong>Yazan:</strong> ${report.commentId.author || 'Bilinmiyor'}
                            </p>
                        </div>
                    ` : ''}
                    
                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        ${report.status === 'pending' ? `
                            <button onclick="updateReportStatus('${report._id}', 'reviewed', 'none')" 
                                style="background: #4CAF50; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer;">
                                ‚úÖ ƒ∞ncelendi
                            </button>
                            <button onclick="deleteCommentFromReport('${report.commentId._id}', '${report.replyId || ''}', '${report._id}')" 
                                style="background: #f44336; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer;">
                                üóëÔ∏è Yorumu Sil
                            </button>
                            <button onclick="updateReportStatus('${report._id}', 'dismissed', 'none')" 
                                style="background: #9E9E9E; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer;">
                                ‚ùå Reddet
                            </button>
                        ` : `
                            <span style="color: #666; font-size: 0.9rem;">
                                ${report.reviewedBy ? `${report.reviewedBy} tarafƒ±ndan ${new Date(report.reviewedAt).toLocaleString('tr-TR')} tarihinde i≈ülendi` : 'ƒ∞≈ülendi'}
                            </span>
                        `}
                    </div>
                </div>
            `).join('');
        }

        // Rapor durumunu g√ºncelle
        async function updateReportStatus(reportId, status, action) {
            try {
                const response = await fetch(`${API_BASE}/reports/admin/reports/${reportId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: JSON.stringify({ status, action })
                });
                
                if (response.ok) {
                    showStatus('Rapor durumu g√ºncellendi', 'success');
                    loadReports(currentReportsPage);
                    loadReportsStats();
                } else {
                    showStatus('Rapor g√ºncellenirken hata olu≈ütu', 'error');
                }
            } catch (error) {
                console.error('Rapor g√ºncelleme hatasƒ±:', error);
                showStatus('Rapor g√ºncellenirken hata olu≈ütu', 'error');
            }
        }

        // Yorumu rapordan sil
        async function deleteCommentFromReport(commentId, replyId, reportId) {
            if (!confirm('Bu yorumu/yanƒ±tƒ± silmek istediƒüinizden emin misiniz?')) return;
            
            try {
                const url = `${API_BASE}/reports/admin/comment/${commentId}${replyId ? `?replyId=${replyId}` : ''}`;
                const response = await fetch(url, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                
                if (response.ok) {
                    // Raporu da √ß√∂z√ºmlendi olarak i≈üaretle
                    await updateReportStatus(reportId, 'resolved', 'comment_deleted');
                    showStatus('Yorum silindi ve rapor √ß√∂z√ºmlendi', 'success');
                } else {
                    showStatus('Yorum silinirken hata olu≈ütu', 'error');
                }
            } catch (error) {
                console.error('Yorum silme hatasƒ±:', error);
                showStatus('Yorum silinirken hata olu≈ütu', 'error');
            }
        }

        // Yorum y√∂netimi i√ßin seri listesini y√ºkle
        async function loadCommentsSeriesList() {
            try {
                const response = await fetch(`${API_BASE}/admin/series-list`);
                const series = await response.json();
                
                const seriesFilter = document.getElementById('series-filter');
                const commentSeriesSelect = document.getElementById('comment-series-select');
                
                // Filtre i√ßin
                seriesFilter.innerHTML = '<option value="">T√ºm Seriler</option>';
                series.forEach(s => {
                    const option = document.createElement('option');
                    option.value = s.seriesId;
                    option.textContent = `${s.title} (${s.chapterCount} b√∂l√ºm)`;
                    seriesFilter.appendChild(option);
                });
                
                // Yorum y√∂netimi i√ßin
                commentSeriesSelect.innerHTML = '<option value="">-- Seri Se√ßin --</option>';
                series.forEach(s => {
                    const option = document.createElement('option');
                    option.value = s.seriesId;
                    option.textContent = `${s.title} (${s.chapterCount} b√∂l√ºm)`;
                    commentSeriesSelect.appendChild(option);
                });
                
            } catch (error) {
                console.error('Seri listesi y√ºklenirken hata:', error);
            }
        }

        // Seri bazƒ±nda yorumlarƒ± y√ºkle
        async function loadSeriesComments(page = 1) {
            const seriesId = document.getElementById('comment-series-select').value;
            if (!seriesId) {
                document.getElementById('series-comments').style.display = 'none';
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/reports/admin/comments/${seriesId}?page=${page}&limit=10`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    renderSeriesComments(data.comments);
                    renderSeriesCommentsPagination(data.page, data.totalPages);
                    document.getElementById('series-comments').style.display = 'block';
                }
            } catch (error) {
                console.error('Seri yorumlarƒ± y√ºklenirken hata:', error);
            }
        }

        // Seri yorumlarƒ±nƒ± render et
        function renderSeriesComments(comments) {
            const listDiv = document.getElementById('series-comments-list');
            
            if (comments.length === 0) {
                listDiv.innerHTML = '<p style="text-align: center; color: #666;">Bu seride yorum bulunamadƒ±.</p>';
                return;
            }

            listDiv.innerHTML = comments.map(comment => {
                // Yorum konumunu belirle
                let location = 'Ana Seri Sayfasƒ±';
                if (comment.chapterNumber) {
                    location = `B√∂l√ºm ${comment.chapterNumber}`;
                } else if (comment.seriesId && comment.seriesId.includes('-chapter-')) {
                    // Eski sistemde seriesId'den b√∂l√ºm numarasƒ±nƒ± √ßƒ±kar
                    const chapterMatch = comment.seriesId.match(/-chapter-(\d+)$/);
                    if (chapterMatch) {
                        location = `B√∂l√ºm ${chapterMatch[1]}`;
                    }
                }
                
                return `
                <div class="comment-item" style="border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin-bottom: 10px; background: white;">
                    <div style="display: flex; justify-content: between; align-items: start;">
                        <div style="flex: 1;">
                            <p style="margin: 0 0 8px 0;">
                                <strong>${comment.author}</strong> - 
                                <span style="color: #666; font-size: 0.9rem;">${new Date(comment.date).toLocaleString('tr-TR')}</span>
                                <span style="background: #2196F3; color: white; padding: 2px 6px; border-radius: 3px; font-size: 0.8rem; margin-left: 10px;">${location}</span>
                                ${comment.deleted ? '<span style="color: red; font-size: 0.8rem; margin-left: 10px;">[Sƒ∞Lƒ∞NDƒ∞]</span>' : ''}
                                ${comment.reported ? '<span style="background: #ff4444; color: white; padding: 2px 6px; border-radius: 3px; font-size: 0.8rem; margin-left: 10px;">RAPORLANDI</span>' : ''}
                            </p>
                            <p style="margin: 0; font-style: italic;">${comment.text}</p>
                            <p style="margin: 8px 0 0 0; font-size: 0.8rem; color: #666;">
                                üëç ${comment.likes} | üëé ${comment.dislikes} | üí¨ ${comment.replies ? comment.replies.length : 0} yanƒ±t
                            </p>
                        </div>
                        <div style="margin-left: 15px;">
                            ${!comment.deleted ? `
                                <button onclick="deleteComment('${comment._id}')" 
                                    style="background: #f44336; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">
                                    üóëÔ∏è Sil
                                </button>
                            ` : ''}
                        </div>
                    </div>
                    
                    ${comment.replies && comment.replies.length > 0 ? `
                        <div style="margin-top: 15px; padding-left: 20px; border-left: 3px solid #eee;">
                            <h5 style="margin: 0 0 10px 0; color: #666;">Yanƒ±tlar:</h5>
                            ${comment.replies.map(reply => `
                                <div style="background: #f9f9f9; padding: 10px; border-radius: 4px; margin-bottom: 8px;">
                                    <p style="margin: 0 0 5px 0; font-size: 0.9rem;">
                                        <strong>${reply.author}</strong> - 
                                        <span style="color: #666; font-size: 0.8rem;">${new Date(reply.date).toLocaleString('tr-TR')}</span>
                                        ${reply.deleted ? '<span style="color: red; font-size: 0.8rem; margin-left: 10px;">[Sƒ∞Lƒ∞NDƒ∞]</span>' : ''}
                                    </p>
                                    <p style="margin: 0; font-size: 0.9rem; font-style: italic;">${reply.text}</p>
                                    ${!reply.deleted ? `
                                        <button onclick="deleteReply('${comment._id}', '${reply._id}')" 
                                            style="background: #f44336; color: white; border: none; padding: 3px 8px; border-radius: 3px; cursor: pointer; font-size: 0.7rem; margin-top: 5px;">
                                            üóëÔ∏è Sil
                                        </button>
                                    ` : ''}
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                </div>
            `;
            }).join('');
        }

        // Yorum sil
        async function deleteComment(commentId) {
            if (!confirm('Bu yorumu silmek istediƒüinizden emin misiniz?')) return;
            
            try {
                const response = await fetch(`${API_BASE}/reports/admin/comment/${commentId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                
                if (response.ok) {
                    showStatus('Yorum silindi', 'success');
                    loadSeriesComments(currentCommentsPage);
                } else {
                    showStatus('Yorum silinirken hata olu≈ütu', 'error');
                }
            } catch (error) {
                console.error('Yorum silme hatasƒ±:', error);
                showStatus('Yorum silinirken hata olu≈ütu', 'error');
            }
        }

        // Yanƒ±t sil
        async function deleteReply(commentId, replyId) {
            if (!confirm('Bu yanƒ±tƒ± silmek istediƒüinizden emin misiniz?')) return;
            
            try {
                const response = await fetch(`${API_BASE}/reports/admin/comment/${commentId}?replyId=${replyId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                
                if (response.ok) {
                    showStatus('Yanƒ±t silindi', 'success');
                    loadSeriesComments(currentCommentsPage);
                } else {
                    showStatus('Yanƒ±t silinirken hata olu≈ütu', 'error');
                }
            } catch (error) {
                console.error('Yanƒ±t silme hatasƒ±:', error);
                showStatus('Yanƒ±t silinirken hata olu≈ütu', 'error');
            }
        }
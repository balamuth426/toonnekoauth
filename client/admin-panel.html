<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ToonNeko Admin Panel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .admin-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .admin-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .admin-content {
            padding: 40px;
        }

        .tab-container {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #f0f0f0;
        }

        .tab-btn {
            padding: 15px 25px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 16px;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            color: #667eea;
            border-bottom-color: #667eea;
            font-weight: 600;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        .images-input-container {
            border: 2px dashed #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            background: #f9f9f9;
        }

        .image-input-item {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        .image-input-item input {
            flex: 1;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-small {
            padding: 8px 15px;
            font-size: 14px;
        }

        .status-message {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .status-message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* Ä°statistik KartlarÄ± */
        .stat-card {
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            flex: 1;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Filtre BÃ¶lÃ¼mÃ¼ */
        .filter-section .form-group {
            margin-bottom: 0;
        }

        .filter-section .form-group label {
            font-size: 0.85rem;
            margin-bottom: 4px;
        }

        .filter-section .form-group select {
            padding: 8px 10px;
            font-size: 0.9rem;
        }

        .preview-container {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .preview-images {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .preview-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .form-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            justify-content: flex-start;
        }

        .edit-form-container {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-top: 20px;
            border: 2px solid #e9ecef;
        }

        .edit-series-header {
            color: #667eea;
            font-size: 1.2rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-row-full {
            grid-column: 1 / -1;
        }

        .edit-form-container {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 30px;
            margin-top: 20px;
        }

        .edit-series-header {
            color: #495057;
            margin-bottom: 25px;
            font-size: 1.5rem;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .preview-container h4 {
            color: #495057;
            margin-bottom: 15px;
        }

        .preview-container img {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-ongoing {
            background: #d4edda;
            color: #155724;
        }

        .status-completed {
            background: #d1ecf1;
            color: #0c5460;
        }

        .status-hiatus {
            background: #fff3cd;
            color: #856404;
        }

        .chapters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .chapter-card {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .chapter-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .chapter-card h4 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 1.2rem;
        }

        .chapter-info {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        .chapter-actions {
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        .edit-image-input-item {
            display: flex;
            gap: 10px;
            margin: 10px 0;
            align-items: center;
        }

        .edit-image-input-item input {
            flex: 1;
        }

        /* Duyuru YÃ¶netimi Stilleri */
        .announcements-list {
            max-height: 600px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-top: 15px;
        }

        .announcement-item {
            padding: 20px;
            border-bottom: 1px solid #f0f0f0;
            background: #fff;
            transition: background-color 0.2s ease;
        }

        .announcement-item:hover {
            background: #f8f9fa;
        }

        .announcement-item:last-child {
            border-bottom: none;
        }

        .announcement-header-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .announcement-title-item {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            margin: 0;
            flex: 1;
        }

        .announcement-type-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            margin-left: 10px;
        }

        .announcement-type-info {
            background: #e3f2fd;
            color: #1976d2;
        }

        .announcement-type-warning {
            background: #fff3e0;
            color: #f57c00;
        }

        .announcement-type-success {
            background: #e8f5e8;
            color: #388e3c;
        }

        .announcement-status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            margin-left: 5px;
        }

        .announcement-active {
            background: #e8f5e8;
            color: #388e3c;
        }

        .announcement-inactive {
            background: #ffebee;
            color: #d32f2f;
        }

        .announcement-content-item {
            color: #666;
            line-height: 1.5;
            margin: 10px 0;
            white-space: pre-wrap;
        }

        .announcement-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
            color: #888;
            margin-top: 15px;
        }

        .announcement-date {
            font-style: italic;
        }

        .announcement-actions {
            display: flex;
            gap: 8px;
        }

        .btn-edit-announcement {
            background: #2196f3;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: background-color 0.2s ease;
        }

        .btn-edit-announcement:hover {
            background: #1976d2;
        }

        .btn-toggle-announcement {
            background: #ff9800;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: background-color 0.2s ease;
        }

        .btn-toggle-announcement:hover {
            background: #f57c00;
        }

        .btn-delete-announcement {
            background: #f44336;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: background-color 0.2s ease;
        }

        .btn-delete-announcement:hover {
            background: #d32f2f;
        }

        .filter-group {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .filter-group label {
            font-weight: 600;
            color: #333;
            margin: 0;
        }

        .filter-group select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.9rem;
            width: auto;
        }

        .pagination-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .pagination-btn {
            padding: 8px 12px;
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }

        .pagination-btn:hover {
            background: #e9ecef;
        }

        .pagination-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Etiket yÃ¶netimi stilleri */
        .label-config {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .label-preview {
            margin-top: 15px;
            padding: 10px;
            background: white;
            border-radius: 5px;
            border: 1px solid #ddd;
        }

        .series-label {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            color: white;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <div class="admin-header">
            <h1>ğŸ¦¸â€â™‚ï¸ ToonNeko Admin Panel</h1>
            <p>Google Drive ile Manhwa YÃ¶netimi (Proxy DesteÄŸi)</p>
        </div>

        <div class="admin-content">
            <div class="tab-container">
                <button class="tab-btn active" onclick="switchTab('series')">ğŸ“š Yeni Seri</button>
                <button class="tab-btn" onclick="switchTab('chapter')">ğŸ“– Yeni BÃ¶lÃ¼m</button>
                <button class="tab-btn" onclick="switchTab('edit')">âœï¸ Seri DÃ¼zenle</button>
                <button class="tab-btn" onclick="switchTab('manage')">âš™ï¸ BÃ¶lÃ¼m YÃ¶netimi</button>
                <button class="tab-btn" onclick="switchTab('stats')">ğŸ“Š Okuma Ä°statistikleri</button>
                <button class="tab-btn" onclick="switchTab('comments')">ğŸ’¬ Yorum YÃ¶netimi</button>
                <button class="tab-btn" onclick="switchTab('announcements')">ğŸ“¢ Duyuru YÃ¶netimi</button>
                <button class="tab-btn" onclick="switchTab('users')">ğŸ‘¥ KullanÄ±cÄ± YÃ¶netimi</button>
                <button class="tab-btn" onclick="switchTab('moderators')">ğŸ›¡ï¸ ModeratÃ¶r YÃ¶netimi</button>
                <button class="tab-btn" onclick="switchTab('delete')">ğŸ—‘ï¸ Seri Sil</button>
                <button class="tab-btn" onclick="switchTab('validate')">ğŸ”— Link DoÄŸrula</button>
            </div>

            <div id="status-message" class="status-message"></div>
            <div id="loading" class="loading">
                <div class="spinner"></div>
                <p>Ä°ÅŸlem gerÃ§ekleÅŸtiriliyor...</p>
            </div>

            <!-- Yeni Seri Ekleme -->
            <div id="series-tab" class="tab-content active">
                <h2>ğŸ“š Yeni Seri Ekle</h2>
                <form id="series-form">
                    <div class="form-group">
                        <label for="series-title">Seri BaÅŸlÄ±ÄŸÄ± *</label>
                        <input type="text" id="series-title" name="title" required>
                    </div>

                    <div class="form-group">
                        <label for="series-id">Seri ID (URL iÃ§in) *</label>
                        <input type="text" id="series-id" name="seriesId" required placeholder="nanomachine, sololeveling vb.">
                    </div>

                    <div class="form-group">
                        <label for="series-summary">AÃ§Ä±klama</label>
                        <textarea id="series-summary" name="summary" placeholder="Serinin aÃ§Ä±klamasÄ±..."></textarea>
                    </div>

                    <div class="form-group">
                        <label for="series-author">Yazar</label>
                        <input type="text" id="series-author" name="author">
                    </div>

                    <div class="form-group">
                        <label for="series-artist">Ã‡izer</label>
                        <input type="text" id="series-artist" name="artist">
                    </div>

                    <div class="form-group">
                        <label for="series-publisher">YayÄ±ncÄ±</label>
                        <input type="text" id="series-publisher" name="publisher">
                    </div>

                    <div class="form-group">
                        <label for="series-cover">Kapak GÃ¶rseli (Google Drive Link) *</label>
                        <input type="url" id="series-cover" name="coverImageUrl" required placeholder="https://drive.google.com/file/d/...">
                        <button type="button" class="btn btn-secondary btn-small" onclick="validateCoverImage()">GÃ¶rseli DoÄŸrula</button>
                    </div>

                    <div class="form-group">
                        <label for="series-status">Durum</label>
                        <select id="series-status" name="status">
                            <option value="Devam Ediyor">Devam Ediyor</option>
                            <option value="TamamlandÄ±">TamamlandÄ±</option>
                            <option value="Beklemede">Beklemede</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="series-genres">TÃ¼rler</label>
                        <input type="text" id="series-genres" name="genres" placeholder="Aksiyon, Fantastik, Dram, ... (virgÃ¼lle ayÄ±r)">
                    </div>

                    <div id="cover-preview" class="preview-container" style="display: none;">
                        <h4>Kapak Ã–nizleme:</h4>
                        <img id="cover-preview-img" class="preview-image" style="max-width: 200px;">
                    </div>

                    <button type="submit" class="btn">ğŸ“š Seri OluÅŸtur</button>
                </form>
            </div>

            <!-- Yeni BÃ¶lÃ¼m Ekleme -->
            <div id="chapter-tab" class="tab-content">
                <h2>ğŸ“– Yeni BÃ¶lÃ¼m Ekle</h2>
                <form id="chapter-form">
                    <div class="form-group">
                        <label for="chapter-series">Seri SeÃ§ *</label>
                        <select id="chapter-series" name="seriesId" required>
                            <option value="">Seri seÃ§in...</option>
                            <option value="sololeveling">Solo Leveling</option>
                            <option value="nanomachine">Nanomachine</option>
                            <option value="omniscientreader">Omniscient Reader</option>
                            <option value="damnreincarnation">Damn Reincarnation</option>
                            <option value="martialgodregressed">Martial God Regressed</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="chapter-number">BÃ¶lÃ¼m NumarasÄ± *</label>
                        <input type="number" id="chapter-number" name="chapterNumber" required min="1">
                    </div>

                    <div class="form-group">
                        <label for="chapter-title">BÃ¶lÃ¼m BaÅŸlÄ±ÄŸÄ±</label>
                        <input type="text" id="chapter-title" name="title" placeholder="Opsiyonel">
                    </div>

                    <div class="form-group">
                        <label>BÃ¶lÃ¼m GÃ¶rselleri (Google Drive Links) *</label>
                        <div class="images-input-container">
                            <div id="image-inputs">
                                <div class="image-input-item">
                                    <input type="url" placeholder="Sayfa 1 Google Drive linki" required>
                                    <button type="button" class="btn btn-danger btn-small" onclick="removeImageInput(this)">Sil</button>
                                </div>
                            </div>
                            <button type="button" class="btn btn-secondary" onclick="addImageInput()">â• GÃ¶rsel Ekle</button>
                        </div>
                    </div>

                    <div id="images-preview" class="preview-container" style="display: none;">
                        <h4>GÃ¶rsel Ã–nizleme:</h4>
                        <div class="preview-images" id="preview-images-container"></div>
                    </div>

                    <button type="submit" class="btn">ğŸ“– BÃ¶lÃ¼m OluÅŸtur</button>
                    <button type="button" class="btn btn-secondary" onclick="previewImages()">ğŸ” GÃ¶rselleri Ã–nizle</button>
                </form>
            </div>

            <!-- Seri DÃ¼zenle -->
            <div id="edit-tab" class="tab-content">
                <h2>âœï¸ Seri DÃ¼zenle</h2>
                
                <div class="form-group">
                    <label for="edit-series-select">DÃ¼zenlenecek Seri</label>
                    <select id="edit-series-select" onchange="loadSeriesForEdit()">
                        <option value="">-- Seri SeÃ§in --</option>
                    </select>
                </div>

                <div id="edit-series-form-container" class="edit-form-container" style="display: none;">
                    <h3 class="edit-series-header">ğŸ“ Seri Bilgilerini DÃ¼zenle</h3>
                    <form id="edit-series-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="edit-series-title">Seri BaÅŸlÄ±ÄŸÄ± *</label>
                                <input type="text" id="edit-series-title" name="title" required>
                            </div>

                            <div class="form-group">
                                <label for="edit-series-status">Seri Durumu *</label>
                                <select id="edit-series-status" name="status" required>
                                    <option value="Devam Ediyor">Devam Ediyor</option>
                                    <option value="TamamlandÄ±">TamamlandÄ±</option>
                                    <option value="Beklemede">Beklemede</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group form-row-full">
                            <label for="edit-series-summary">Seri Ã–zeti</label>
                            <textarea id="edit-series-summary" name="summary" placeholder="Serinin aÃ§Ä±klamasÄ±..." rows="4"></textarea>
                        </div>

                        <div class="form-group form-row-full">
                            <label for="edit-series-cover">Kapak GÃ¶rseli (Google Drive Link) *</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="url" id="edit-series-cover" name="image" required style="flex: 1;">
                                <button type="button" class="btn btn-secondary btn-small" onclick="validateEditCoverImage()">ğŸ” GÃ¶rseli DoÄŸrula</button>
                            </div>
                        </div>

                        <div class="form-group form-row-full">
                            <label for="edit-series-genres">Seri TÃ¼rleri (virgÃ¼lle ayÄ±rarak yazÄ±n)</label>
                            <input type="text" id="edit-series-genres" name="genres" placeholder="Aksiyon, Fantastik, Dram...">
                            <small style="color: #666; font-size: 14px; margin-top: 5px; display: block;">Ã–rnek: Aksiyon, Fantastik, Dram, Komedi</small>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="edit-series-author">Yazar</label>
                                <input type="text" id="edit-series-author" name="author">
                            </div>

                            <div class="form-group">
                                <label for="edit-series-artist">Ã‡izer</label>
                                <input type="text" id="edit-series-artist" name="artist">
                            </div>
                        </div>

                        <div class="form-group form-row-full">
                            <label for="edit-series-publisher">YayÄ±ncÄ±</label>
                            <input type="text" id="edit-series-publisher" name="publisher">
                        </div>

                        <!-- Seri Etiketi -->
                        <div class="form-group form-row-full">
                            <label>ğŸ“‹ Seri Etiketi</label>
                            <div class="label-config">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="edit-series-label-enabled">Etiket Durumu</label>
                                        <select id="edit-series-label-enabled" onchange="toggleLabelSettings()">
                                            <option value="none">Etiket Yok</option>
                                            <option value="false">Etiketi Gizle</option>
                                            <option value="true">Etiketi GÃ¶ster</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div id="label-settings" style="display: none;">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="edit-series-label-text">Etiket Metni</label>
                                            <select id="edit-series-label-text">
                                                <option value="Yeni">ğŸŒŸ Yeni</option>
                                                <option value="GÃ¼ncel">ğŸ”¥ GÃ¼ncel</option>
                                                <option value="Yeni Sezon">ğŸ“º Yeni Sezon</option>
                                                <option value="Sezon Finali">ğŸ Sezon Finali</option>
                                                <option value="PopÃ¼ler">â­ PopÃ¼ler</option>
                                                <option value="TamamlandÄ±">âœ… TamamlandÄ±</option>
                                                <option value="Ara Verildi">â¸ï¸ Ara Verildi</option>
                                                <option value="BÄ±rakÄ±ldÄ±">ğŸ›‘ BÄ±rakÄ±ldÄ±</option>
                                            </select>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="edit-series-label-color">Etiket Rengi</label>
                                            <select id="edit-series-label-color">
                                                <option value="#4CAF50">ğŸŸ¢ YeÅŸil (Yeni)</option>
                                                <option value="#FF9800">ğŸŸ  Turuncu (GÃ¼ncel)</option>
                                                <option value="#2196F3">ğŸ”µ Mavi (Sezon)</option>
                                                <option value="#9C27B0">ğŸŸ£ Mor (Final)</option>
                                                <option value="#F44336">ğŸ”´ KÄ±rmÄ±zÄ± (PopÃ¼ler)</option>
                                                <option value="#607D8B">âš« Gri (TamamlandÄ±)</option>
                                                <option value="#FFC107">ğŸŸ¡ SarÄ± (Ara Verildi)</option>
                                                <option value="#795548">ğŸ¤ Kahverengi (BÄ±rakÄ±ldÄ±)</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div class="label-preview">
                                        <span>Ã–nizleme: </span>
                                        <span id="label-preview-badge" class="series-label" style="background: #4CAF50;">ğŸŒŸ Yeni</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="edit-cover-preview" class="preview-container" style="display: none;">
                            <h4>ğŸ“¸ Kapak Ã–nizleme:</h4>
                            <img id="edit-preview-image" style="max-width: 200px; border-radius: 8px;">
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn">ğŸ’¾ DeÄŸiÅŸiklikleri Kaydet</button>
                            <button type="button" class="btn btn-secondary" onclick="cancelEdit()">âŒ Ä°ptal</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Seri Silme -->
            <div id="delete-tab" class="tab-content">
                <h2>ğŸ—‘ï¸ Seri Sil</h2>
                <div class="warning-box" style="background: #ffe6e6; border: 1px solid #ff6b6b; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <strong>âš ï¸ DÄ°KKAT:</strong> Bu iÅŸlem geri alÄ±namaz! Seriyi sildiÄŸinizde:
                    <ul style="margin: 10px 0 0 20px;">
                        <li>manhwalar.json'dan seri bilgileri silinir</li>
                        <li>chapters/ klasÃ¶rÃ¼nden tÃ¼m bÃ¶lÃ¼mler silinir</li>
                        <li>series/ klasÃ¶rÃ¼nden seri sayfasÄ± silinir</li>
                        <li>VeritabanÄ±ndan tÃ¼m yorumlar, puanlar ve favori kayÄ±tlarÄ± silinir</li>
                    </ul>
                </div>

                <div class="form-group">
                    <label for="delete-series">Silinecek Seri</label>
                    <select id="delete-series" required>
                        <option value="">-- Seri SeÃ§in --</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="confirm-delete">Silme iÅŸlemini onaylamak iÃ§in "SÄ°L" yazÄ±n</label>
                    <input type="text" id="confirm-delete" placeholder="SÄ°L yazÄ±n" maxlength="3">
                </div>

                <button type="button" class="btn" style="background: #ff6b6b;" onclick="deleteSeries()" id="delete-btn" disabled>
                    ğŸ—‘ï¸ Seriyi Sil
                </button>

                <div id="delete-result" class="result-container" style="display: none;">
                    <h4>Silme Sonucu:</h4>
                    <div id="delete-details"></div>
                </div>
            </div>

            <!-- Okuma Ä°statistikleri -->
            <div id="stats-tab" class="tab-content">
                <h2>ğŸ“Š Okuma Ä°statistikleri</h2>
                
                <!-- Ä°statistik KartlarÄ± -->
                <div class="stats-container" style="display: flex; gap: 20px; margin-bottom: 30px; flex-wrap: wrap;">
                    <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; min-width: 200px;">
                        <div class="stat-number" id="total-reads-today">-</div>
                        <div class="stat-label">BugÃ¼nkÃ¼ Okumalar</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; min-width: 200px;">
                        <div class="stat-number" id="total-reads-week">-</div>
                        <div class="stat-label">Bu Hafta</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; min-width: 200px;">
                        <div class="stat-number" id="total-reads-all">-</div>
                        <div class="stat-label">Toplam Okuma</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: white; min-width: 200px;">
                        <div class="stat-number" id="total-series-read">-</div>
                        <div class="stat-label">Okunan Seri SayÄ±sÄ±</div>
                    </div>
                </div>

                <!-- Filtreler -->
                <div class="form-group" style="margin-bottom: 20px;">
                    <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                        <div>
                            <label for="stats-series-filter">Seri Filtresi:</label>
                            <select id="stats-series-filter" style="padding: 8px; border-radius: 4px; border: 1px solid #ddd; min-width: 200px;">
                                <option value="">TÃ¼m Seriler</option>
                            </select>
                        </div>
                        <div>
                            <label for="stats-period-filter">DÃ¶nem:</label>
                            <select id="stats-period-filter" style="padding: 8px; border-radius: 4px; border: 1px solid #ddd;">
                                <option value="all">TÃ¼m Zamanlar</option>
                                <option value="week">Bu Hafta</option>
                                <option value="month">Bu Ay</option>
                            </select>
                        </div>
                        <button onclick="loadDetailedStats()" style="padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
                            ğŸ”„ Yenile
                        </button>
                    </div>
                </div>

                <!-- En PopÃ¼ler Seriler -->
                <div style="margin-bottom: 30px;">
                    <h3>ğŸ”¥ En PopÃ¼ler Seriler</h3>
                    <div class="table-container">
                        <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <thead style="background: #f8f9fa;">
                                <tr>
                                    <th style="padding: 12px; text-align: left; border-bottom: 1px solid #dee2e6;">#</th>
                                    <th style="padding: 12px; text-align: left; border-bottom: 1px solid #dee2e6;">Seri AdÄ±</th>
                                    <th style="padding: 12px; text-align: center; border-bottom: 1px solid #dee2e6;">Toplam Okuma</th>
                                    <th style="padding: 12px; text-align: center; border-bottom: 1px solid #dee2e6;">HaftalÄ±k</th>
                                    <th style="padding: 12px; text-align: center; border-bottom: 1px solid #dee2e6;">BÃ¶lÃ¼m SayÄ±sÄ±</th>
                                    <th style="padding: 12px; text-align: center; border-bottom: 1px solid #dee2e6;">Ortalama/BÃ¶lÃ¼m</th>
                                    <th style="padding: 12px; text-align: center; border-bottom: 1px solid #dee2e6;">Son Okuma</th>
                                </tr>
                            </thead>
                            <tbody id="popular-series-table">
                                <tr>
                                    <td colspan="7" style="padding: 20px; text-align: center; color: #666;">Ä°statistikler yÃ¼kleniyor...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- DetaylÄ± BÃ¶lÃ¼m Ä°statistikleri -->
                <div>
                    <h3>ğŸ“– DetaylÄ± BÃ¶lÃ¼m Ä°statistikleri</h3>
                    <div class="table-container">
                        <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <thead style="background: #f8f9fa;">
                                <tr>
                                    <th style="padding: 12px; text-align: left; border-bottom: 1px solid #dee2e6;">Seri</th>
                                    <th style="padding: 12px; text-align: center; border-bottom: 1px solid #dee2e6;">BÃ¶lÃ¼m</th>
                                    <th style="padding: 12px; text-align: center; border-bottom: 1px solid #dee2e6;">Toplam Okuma</th>
                                    <th style="padding: 12px; text-align: center; border-bottom: 1px solid #dee2e6;">HaftalÄ±k</th>
                                    <th style="padding: 12px; text-align: center; border-bottom: 1px solid #dee2e6;">GÃ¼nlÃ¼k</th>
                                    <th style="padding: 12px; text-align: center; border-bottom: 1px solid #dee2e6;">Son Okuma</th>
                                </tr>
                            </thead>
                            <tbody id="detailed-stats-table">
                                <tr>
                                    <td colspan="6" style="padding: 20px; text-align: center; color: #666;">Ä°statistikler yÃ¼kleniyor...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Pagination -->
                    <div id="stats-pagination" style="margin-top: 20px; text-align: center;">
                        <!-- Pagination controls will be added here -->
                    </div>
                </div>
            </div>

            <!-- Yorum YÃ¶netimi -->
            <div id="comments-tab" class="tab-content">
                <h2>ğŸ’¬ Yorum YÃ¶netimi</h2>
                
                <!-- Rapor Ä°statistikleri -->
                <div class="stats-container" style="display: flex; gap: 20px; margin-bottom: 30px;">
                    <div class="stat-card" style="background: #ff4444; color: white;">
                        <div class="stat-number" id="pending-reports">-</div>
                        <div class="stat-label">Bekleyen Raporlar</div>
                    </div>
                    <div class="stat-card" style="background: #4CAF50; color: white;">
                        <div class="stat-number" id="total-reports">-</div>
                        <div class="stat-label">Toplam Raporlar</div>
                    </div>
                    <div class="stat-card" style="background: #ff9800; color: white;">
                        <div class="stat-number" id="reported-comments">-</div>
                        <div class="stat-label">Raporlanan Yorumlar</div>
                    </div>
                </div>

                <!-- Filtreler -->
                <div class="filter-section" style="background: #f5f5f5; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                    <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                        <div class="form-group" style="margin: 0; min-width: 150px;">
                            <label>Rapor Durumu:</label>
                            <select id="report-status-filter" onchange="loadReports()">
                                <option value="pending">Bekleyen</option>
                                <option value="reviewed">Ä°ncelenen</option>
                                <option value="resolved">Ã‡Ã¶zÃ¼mlenen</option>
                                <option value="dismissed">Reddedilen</option>
                                <option value="all">TÃ¼mÃ¼</option>
                            </select>
                        </div>
                        <div class="form-group" style="margin: 0; min-width: 150px;">
                            <label>Seri:</label>
                            <select id="series-filter" onchange="loadReports()">
                                <option value="">TÃ¼m Seriler</option>
                            </select>
                        </div>
                        <button onclick="loadReports()" style="background: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">ğŸ”„ Yenile</button>
                    </div>
                </div>

                <!-- Raporlar Listesi -->
                <div class="reports-section">
                    <h3>ğŸ“‹ Raporlanan Yorumlar</h3>
                    <div id="reports-list"></div>
                    <div id="reports-pagination" style="text-align: center; margin-top: 20px;"></div>
                </div>

                <!-- Seri BazÄ±nda Yorum YÃ¶netimi -->
                <div class="comments-management" style="margin-top: 40px;">
                    <h3>ğŸ—‚ï¸ Seri BazÄ±nda Yorum YÃ¶netimi</h3>
                    <div class="form-group">
                        <label>Seri SeÃ§in:</label>
                        <select id="comment-series-select" onchange="loadSeriesComments()">
                            <option value="">-- Seri SeÃ§in --</option>
                        </select>
                    </div>
                    <div id="series-comments" style="display: none;">
                        <div id="series-comments-list"></div>
                        <div id="series-comments-pagination" style="text-align: center; margin-top: 20px;"></div>
                    </div>
                </div>
            </div>

            <!-- Duyuru YÃ¶netimi -->
            <div id="announcements-tab" class="tab-content">
                <h2>ğŸ“¢ Duyuru YÃ¶netimi</h2>
                
                <!-- Yeni Duyuru Ekleme -->
                <div class="form-section">
                    <h3>ğŸ†• Yeni Duyuru Ekle</h3>
                    <form id="announcement-form">
                        <div class="form-group">
                            <label for="announcement-title">BaÅŸlÄ±k:</label>
                            <input type="text" id="announcement-title" name="title" required maxlength="200" placeholder="Duyuru baÅŸlÄ±ÄŸÄ±">
                        </div>
                        
                        <div class="form-group">
                            <label for="announcement-content">Ä°Ã§erik:</label>
                            <textarea id="announcement-content" name="content" required rows="4" placeholder="Duyuru iÃ§eriÄŸi..."></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="announcement-type">Tip:</label>
                            <select id="announcement-type" name="type" required>
                                <option value="info">â„¹ï¸ Bilgi</option>
                                <option value="warning">âš ï¸ UyarÄ±</option>
                                <option value="success">âœ… BaÅŸarÄ±</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="announcement-active" name="isActive" checked>
                                Duyuru aktif olsun
                            </label>
                        </div>
                        
                        <div class="button-group">
                            <button type="submit" class="btn-primary">ğŸ“¢ Duyuru Ekle</button>
                            <button type="button" id="clear-announcement-form" class="btn-secondary">ğŸ§¹ Temizle</button>
                        </div>
                    </form>
                </div>

                <!-- Mevcut Duyurular -->
                <div class="form-section">
                    <h3>ğŸ“‹ Mevcut Duyurular</h3>
                    <div class="filter-group">
                        <label for="announcement-filter">Filtrele:</label>
                        <select id="announcement-filter">
                            <option value="all">TÃ¼mÃ¼</option>
                            <option value="active">Aktif</option>
                            <option value="inactive">Pasif</option>
                        </select>
                        <button id="refresh-announcements" class="btn-secondary">ğŸ”„ Yenile</button>
                    </div>
                    <div id="announcements-list" class="announcements-list">
                        <!-- Duyurular buraya yÃ¼klenecek -->
                    </div>
                    <div id="announcements-pagination" class="pagination-container"></div>
                </div>
            </div>

            <!-- KullanÄ±cÄ± YÃ¶netimi -->
            <div id="users-tab" class="tab-content">
                <h2>ğŸ‘¥ KullanÄ±cÄ± YÃ¶netimi</h2>
                
                <!-- KullanÄ±cÄ± Ä°statistikleri -->
                <div class="stats-container" style="display: flex; gap: 20px; margin-bottom: 30px;">
                    <div class="stat-card" style="flex: 1; background: #f8f9fa; padding: 20px; border-radius: 10px; text-align: center;">
                        <h3 style="color: #667eea; margin-bottom: 10px;" id="total-users-count">0</h3>
                        <p style="color: #666;">Toplam KullanÄ±cÄ±</p>
                    </div>
                    <div class="stat-card" style="flex: 1; background: #f8f9fa; padding: 20px; border-radius: 10px; text-align: center;">
                        <h3 style="color: #28a745; margin-bottom: 10px;" id="admin-users-count">0</h3>
                        <p style="color: #666;">Admin KullanÄ±cÄ±</p>
                    </div>
                    <div class="stat-card" style="flex: 1; background: #f8f9fa; padding: 20px; border-radius: 10px; text-align: center;">
                        <h3 style="color: #ffc107; margin-bottom: 10px;" id="moderator-users-count">0</h3>
                        <p style="color: #666;">ModeratÃ¶r</p>
                    </div>
                    <div class="stat-card" style="flex: 1; background: #f8f9fa; padding: 20px; border-radius: 10px; text-align: center;">
                        <h3 style="color: #dc3545; margin-bottom: 10px;" id="blocked-users-count">0</h3>
                        <p style="color: #666;">Engelli KullanÄ±cÄ±</p>
                    </div>
                </div>

                <!-- KullanÄ±cÄ± Arama -->
                <div class="form-group">
                    <label for="user-search">ğŸ” KullanÄ±cÄ± Ara</label>
                    <input type="text" id="user-search" placeholder="KullanÄ±cÄ± adÄ± veya e-posta ile ara..." onkeyup="filterUsers()">
                </div>

                <!-- KullanÄ±cÄ± Listesi -->
                <div id="users-list-container">
                    <div id="users-loading" style="text-align: center; padding: 40px; color: #666;">
                        <div style="font-size: 18px;">KullanÄ±cÄ±lar yÃ¼kleniyor...</div>
                    </div>
                    <div id="users-list" style="display: none;"></div>
                </div>

                <!-- KullanÄ±cÄ± Detay ModalÄ± -->
                <div id="user-detail-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 15px; width: 90%; max-width: 600px; max-height: 80%; overflow-y: auto;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3>ğŸ‘¤ KullanÄ±cÄ± DetaylarÄ±</h3>
                            <button onclick="closeUserModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #999;">&times;</button>
                        </div>
                        <div id="user-detail-content"></div>
                        
                        <!-- ModeratÃ¶r Atama BÃ¶lÃ¼mÃ¼ -->
                        <div id="moderator-assignment-section" style="display: none; margin-top: 20px; padding-top: 20px; border-top: 2px solid #f0f0f0;">
                            <h4 style="margin-bottom: 15px; color: #667eea;">ğŸ›¡ï¸ ModeratÃ¶r YÃ¶netimi</h4>
                            <form id="user-moderator-form">
                                <input type="hidden" id="selected-user-id">
                                
                                <div class="form-group">
                                    <label for="user-series-select">Atanacak Seriler (Ctrl+Click ile Ã§oklu seÃ§im)</label>
                                    <select id="user-series-select" multiple size="6" style="min-height: 150px; width: 100%;">
                                        <!-- Seriler dinamik olarak yÃ¼klenecek -->
                                    </select>
                                    <small style="color: #666; display: block; margin-top: 5px;">
                                        Ctrl tuÅŸuna basarak birden fazla seri seÃ§ebilirsiniz
                                    </small>
                                </div>
                                
                                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 15px;">
                                    <button type="button" id="make-moderator-btn" class="btn" onclick="makeUserModerator()">
                                        ğŸ›¡ï¸ ModeratÃ¶r Yap
                                    </button>
                                    <button type="button" id="update-moderator-btn" class="btn" onclick="updateUserModeratorSeries()" style="display: none;">
                                        ğŸ’¾ Serileri GÃ¼ncelle
                                    </button>
                                    <button type="button" id="remove-moderator-btn" class="btn btn-danger" onclick="removeUserModerator()" style="display: none;">
                                        ğŸ—‘ï¸ ModeratÃ¶r KaldÄ±r
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ModeratÃ¶r YÃ¶netimi -->
            <div id="moderators-tab" class="tab-content">
                <h2>ğŸ›¡ï¸ ModeratÃ¶r YÃ¶netimi</h2>
                
                <!-- ModeratÃ¶r Ä°statistikleri -->
                <div class="stats-container" style="display: flex; gap: 20px; margin-bottom: 30px;">
                    <div class="stat-card" style="flex: 1; background: #f8f9fa; padding: 20px; border-radius: 10px; text-align: center;">
                        <h3 style="color: #667eea; margin-bottom: 10px;" id="total-moderators-count">0</h3>
                        <p style="color: #666;">Toplam ModeratÃ¶r</p>
                    </div>
                    <div class="stat-card" style="flex: 1; background: #f8f9fa; padding: 20px; border-radius: 10px; text-align: center;">
                        <h3 style="color: #28a745; margin-bottom: 10px;" id="active-moderators-count">0</h3>
                        <p style="color: #666;">Aktif ModeratÃ¶r</p>
                    </div>
                    <div class="stat-card" style="flex: 1; background: #f8f9fa; padding: 20px; border-radius: 10px; text-align: center;">
                        <h3 style="color: #ffc107; margin-bottom: 10px;" id="managed-series-count">0</h3>
                        <p style="color: #666;">YÃ¶netilen Seri</p>
                    </div>
                </div>

                <!-- Mevcut ModeratÃ¶rler -->
                <div>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>ğŸ“‹ Mevcut ModeratÃ¶rler</h3>
                        <div style="color: #666; font-size: 14px;">
                            ğŸ’¡ Yeni moderatÃ¶r atamak iÃ§in "KullanÄ±cÄ± YÃ¶netimi" sekmesini kullanÄ±n
                        </div>
                    </div>
                    <div id="moderators-loading" style="text-align: center; padding: 40px; color: #666;">
                        <div style="font-size: 18px;">ModeratÃ¶rler yÃ¼kleniyor...</div>
                    </div>
                    <div id="moderators-list" style="display: none;"></div>
                </div>

                <!-- ModeratÃ¶r DÃ¼zenleme ModalÄ± -->
                <div id="moderator-edit-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 15px; width: 90%; max-width: 600px; max-height: 80%; overflow-y: auto;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3>âœï¸ ModeratÃ¶r DÃ¼zenle</h3>
                            <button onclick="closeModeratorModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #999;">&times;</button>
                        </div>
                        <form id="edit-moderator-form">
                            <input type="hidden" id="edit-moderator-id">
                            
                            <div class="form-group">
                                <label>KullanÄ±cÄ± Bilgileri</label>
                                <div id="edit-moderator-info" style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                    <!-- KullanÄ±cÄ± bilgileri buraya gelecek -->
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="edit-series-select">AtanmÄ±ÅŸ Seriler</label>
                                <select id="edit-series-select" multiple size="8" style="min-height: 200px;">
                                    <!-- Seriler dinamik olarak yÃ¼klenecek -->
                                </select>
                                <small style="color: #666; display: block; margin-top: 5px;">
                                    Ctrl tuÅŸuna basarak birden fazla seri seÃ§ebilirsiniz
                                </small>
                            </div>
                            
                            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                                <button type="submit" class="btn">ğŸ’¾ GÃ¼ncelle</button>
                                <button type="button" class="btn btn-danger" onclick="removeModerator()">ğŸ—‘ï¸ ModeratÃ¶r KaldÄ±r</button>
                                <button type="button" class="btn btn-secondary" onclick="closeModeratorModal()">âŒ Ä°ptal</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Link DoÄŸrulama -->
            <div id="validate-tab" class="tab-content">
                <h2>ğŸ”— Google Drive Link DoÄŸrula</h2>
                <form id="validate-form">
                    <div class="form-group">
                        <label for="validate-url">Google Drive Link</label>
                        <input type="url" id="validate-url" name="driveUrl" required placeholder="https://drive.google.com/file/d/...">
                    </div>

                    <button type="submit" class="btn">ğŸ” DoÄŸrula</button>
                </form>

                <div id="validation-result" class="preview-container" style="display: none;">
                    <h4>DoÄŸrulama Sonucu:</h4>
                    <div id="validation-details"></div>
                </div>
            </div>

            <!-- BÃ¶lÃ¼m YÃ¶netimi Tab -->
            <div id="manage-tab" class="tab-content" style="display: none;">
                <h2>âš™ï¸ BÃ¶lÃ¼m YÃ¶netimi</h2>
                
                <!-- Seri SeÃ§imi -->
                <div class="form-group">
                    <label for="manage-series">Seri SeÃ§</label>
                    <select id="manage-series" onchange="loadSeriesChapters(this.value)">
                        <option value="">-- Seri SeÃ§in --</option>
                    </select>
                </div>

                <!-- BÃ¶lÃ¼m Listesi -->
                <div id="chapters-list-container" style="display: none;">
                    <h3>ğŸ“– BÃ¶lÃ¼mler</h3>
                    <div id="chapters-list"></div>
                </div>

                <!-- BÃ¶lÃ¼m DÃ¼zenleme Formu -->
                <div id="chapter-edit-form" class="preview-container" style="display: none;">
                    <h3>âœï¸ BÃ¶lÃ¼m DÃ¼zenle</h3>
                    <form id="edit-chapter-form">
                        <input type="hidden" id="edit-series-id">
                        <input type="hidden" id="edit-chapter-original-number">
                        
                        <div class="form-group">
                            <label for="edit-chapter-number">BÃ¶lÃ¼m NumarasÄ±</label>
                            <input type="number" id="edit-chapter-number" required min="1">
                        </div>
                        
                        <div class="form-group">
                            <label for="edit-chapter-title">BÃ¶lÃ¼m BaÅŸlÄ±ÄŸÄ±</label>
                            <input type="text" id="edit-chapter-title" required>
                        </div>
                        
                        <div class="form-group">
                            <label>GÃ¶rsel URL'leri</label>
                            <div id="edit-image-inputs" class="images-input-container">
                                <!-- Dinamik olarak doldurulacak -->
                            </div>
                            <button type="button" class="btn btn-secondary" onclick="addEditImageInput()">â• GÃ¶rsel Ekle</button>
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="btn">ğŸ’¾ GÃ¼ncelle</button>
                            <button type="button" class="btn btn-secondary" onclick="cancelEdit()">âŒ Ä°ptal</button>
                            <button type="button" class="btn btn-danger" onclick="deleteChapter()">ğŸ—‘ï¸ Sil</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="config.js?v=5"></script>
    <script>
        // API Base URL - local development iÃ§in
        const API_BASE = 'https://toonnekoauth-api.onrender.com/api';
        
        // GiriÅŸ kontrolÃ¼
        function checkAuthentication() {
            const token = localStorage.getItem('token');
            if (!token) {
                // Ana iÃ§eriÄŸi gizle
                document.querySelector('.admin-container').style.display = 'none';
                // GiriÅŸ sayfasÄ±na yÃ¶nlendir veya giriÅŸ modalÄ± gÃ¶ster
                showLoginForm();
                return false;
            }
            return true;
        }
        
        // Basit giriÅŸ formu gÃ¶ster
        function showLoginForm() {
            const loginHtml = `
                <div id="login-overlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 9999; display: flex; align-items: center; justify-content: center;">
                    <div style="background: white; padding: 30px; border-radius: 15px; width: 400px; max-width: 90%;">
                        <h2 style="text-align: center; margin-bottom: 20px; color: #333;">Admin Paneli GiriÅŸi</h2>
                        <form id="admin-login-form">
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">KullanÄ±cÄ± AdÄ± veya Email:</label>
                                <input type="text" id="admin-username" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;" required>
                            </div>
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Åifre:</label>
                                <input type="password" id="admin-password" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;" required>
                            </div>
                            <button type="submit" style="width: 100%; padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 5px; font-size: 16px; cursor: pointer;">GiriÅŸ Yap</button>
                            <div id="login-error" style="color: #dc3545; text-align: center; margin-top: 10px; display: none;"></div>
                        </form>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', loginHtml);
            
            document.getElementById('admin-login-form').addEventListener('submit', handleAdminLogin);
        }
        
        // Admin giriÅŸi iÅŸle
        async function handleAdminLogin(e) {
            e.preventDefault();
            
            const username = document.getElementById('admin-username').value;
            const password = document.getElementById('admin-password').value;
            const errorDiv = document.getElementById('login-error');
            
            try {
                const response = await fetch('https://toonnekoauth-api.onrender.com/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ identifier: username, password })
                });
                
                const data = await response.json();
                
                if (response.ok && data.token) {
                    // Admin kontrolÃ¼
                    if (!data.user.isAdmin) {
                        errorDiv.textContent = 'Bu hesap admin yetkisine sahip deÄŸil.';
                        errorDiv.style.display = 'block';
                        return;
                    }
                    
                    localStorage.setItem('token', data.token);
                    document.getElementById('login-overlay').remove();
                    
                    // Ana iÃ§eriÄŸi gÃ¶ster
                    document.querySelector('.admin-container').style.display = 'block';
                    
                    // HoÅŸ geldin mesajÄ±
                    alert(`HoÅŸ geldiniz, ${data.user.username}!`);
                } else {
                    errorDiv.textContent = data.message || 'GiriÅŸ baÅŸarÄ±sÄ±z';
                    errorDiv.style.display = 'block';
                }
            } catch (error) {
                errorDiv.textContent = 'GiriÅŸ yapÄ±lÄ±rken hata oluÅŸtu: ' + error.message;
                errorDiv.style.display = 'block';
            }
        }
        
        // Google Drive Helper Functions
        function extractFileId(driveUrl) {
            const match = driveUrl.match(/\/file\/d\/([a-zA-Z0-9_-]+)/);
            return match ? match[1] : null;
        }
        
        function createProxyUrl(fileId) {
            return `${API_BASE}/image/proxy-image/${fileId}`;
        }
        
        function createDirectUrls(fileId) {
            return {
                proxy: `${API_BASE}/image/proxy-image/${fileId}`,
                high: `https://drive.google.com/uc?export=view&id=${fileId}`,
                download: `https://drive.usercontent.google.com/download?id=${fileId}&authuser=0`,
                medium: `https://drive.google.com/uc?id=${fileId}`,
                thumbnail: `https://drive.google.com/thumbnail?id=${fileId}&sz=s1600`
            };
        }
        
        // Tab switching
        function switchTab(tabName) {
            // Remove active class from all tabs
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
                content.style.display = 'none';
            });
            
            // Add active class to selected tab
            event.target.classList.add('active');
            const targetTab = document.getElementById(tabName + '-tab');
            targetTab.classList.add('active');
            targetTab.style.display = 'block';
            
            // Manage tab aÃ§Ä±ldÄ±ÄŸÄ±nda serileri yÃ¼kle
            if (tabName === 'manage') {
                loadSeriesList();
            }
            
            // Chapter tab aÃ§Ä±ldÄ±ÄŸÄ±nda serileri yÃ¼kle
            if (tabName === 'chapter') {
                loadChapterSeriesList();
            }
            
            // Edit tab aÃ§Ä±ldÄ±ÄŸÄ±nda serileri yÃ¼kle
            if (tabName === 'edit') {
                loadEditSeriesList();
            }
            
            // Delete tab aÃ§Ä±ldÄ±ÄŸÄ±nda serileri yÃ¼kle
            if (tabName === 'delete') {
                loadDeleteSeriesList();
            }
            
            // Comments tab aÃ§Ä±ldÄ±ÄŸÄ±nda verileri yÃ¼kle
            if (tabName === 'comments') {
                loadReportsStats();
                loadReports();
                loadCommentsSeriesList();
            }
            
            // Stats tab aÃ§Ä±ldÄ±ÄŸÄ±nda istatistikleri yÃ¼kle
            if (tabName === 'stats') {
                loadStatsOverview();
                loadDetailedStats();
                loadStatsSeriesList();
            }
            
            // Announcements tab aÃ§Ä±ldÄ±ÄŸÄ±nda duyurularÄ± yÃ¼kle
            if (tabName === 'announcements') {
                loadAnnouncements();
            }
        }

        // Show status message
        function showStatus(message, type) {
            const statusDiv = document.getElementById('status-message');
            statusDiv.textContent = message;
            statusDiv.className = `status-message ${type}`;
            statusDiv.style.display = 'block';
            
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }

        // Show/hide loading
        function toggleLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        // Show/hide loading (alias for consistency)
        function showLoading(show) {
            toggleLoading(show);
        }

        // Get auth token (assuming it's stored in localStorage)
        function getAuthToken() {
            // Test iÃ§in varsayÄ±lan token
            return localStorage.getItem('token') || 'test-admin-token-for-development';
        }

        // Image input management
        function addImageInput() {
            const container = document.getElementById('image-inputs');
            const inputCount = container.children.length;
            
            const newInputDiv = document.createElement('div');
            newInputDiv.className = 'image-input-item';
            newInputDiv.innerHTML = `
                <input type="url" placeholder="Sayfa ${inputCount + 1} Google Drive linki" required>
                <button type="button" class="btn btn-danger btn-small" onclick="removeImageInput(this)">Sil</button>
            `;
            
            container.appendChild(newInputDiv);
        }

        function removeImageInput(button) {
            const container = document.getElementById('image-inputs');
            if (container.children.length > 1) {
                button.parentElement.remove();
                
                // Update placeholders
                const inputs = container.querySelectorAll('input');
                inputs.forEach((input, index) => {
                    input.placeholder = `Sayfa ${index + 1} Google Drive linki`;
                });
            }
        }

        // Cover image validation
        async function validateCoverImage() {
            const coverUrl = document.getElementById('series-cover').value;
            if (!coverUrl) {
                showStatus('LÃ¼tfen kapak gÃ¶rseli linkini girin', 'error');
                return;
            }

            const fileId = extractFileId(coverUrl);
            if (!fileId) {
                showStatus('GeÃ§ersiz Google Drive link formatÄ±!', 'error');
                return;
            }

            toggleLoading(true);
            showStatus(`File ID: ${fileId} - Test baÅŸlatÄ±lÄ±yor...`, 'info');
            
            try {
                // Test multiple URL formats
                const proxyUrl = `${API_BASE}/image/proxy-image/${fileId}`;
                const directUrls = createDirectUrls(fileId);
                
                console.log('Testing URLs:', { proxyUrl, directUrls });
                
                // Clear previous preview
                const previewDiv = document.getElementById('cover-preview');
                previewDiv.innerHTML = `
                    <h4>GÃ¶rsel Test SonuÃ§larÄ±:</h4>
                    <div id="test-results"></div>
                `;
                previewDiv.style.display = 'block';
                
                const resultsDiv = document.getElementById('test-results');
                
                // Test proxy URL first (recommended)
                await testImageFormat(resultsDiv, 'Server Proxy (Ã–nerilen)', proxyUrl, true);
                
                // Test direct formats
                await testImageFormat(resultsDiv, 'High Quality Direct', directUrls.high, false);
                await testImageFormat(resultsDiv, 'Download Format', directUrls.download, false);
                await testImageFormat(resultsDiv, 'Medium Quality', directUrls.medium, false);
                
            } catch (error) {
                showStatus('DoÄŸrulama sÄ±rasÄ±nda hata oluÅŸtu: ' + error.message, 'error');
                console.error('Validation error:', error);
            }
            
            toggleLoading(false);
        }
        
        async function testImageFormat(container, formatName, url, isRecommended) {
            return new Promise((resolve) => {
                const testDiv = document.createElement('div');
                testDiv.style.cssText = `
                    margin: 10px 0; 
                    padding: 10px; 
                    border: 1px solid #ddd; 
                    border-radius: 5px;
                    background: ${isRecommended ? '#e8f5e8' : '#f8f9fa'};
                `;
                
                testDiv.innerHTML = `
                    <h5>${isRecommended ? 'ğŸ›¡ï¸' : 'ğŸŒ'} ${formatName}</h5>
                    <div style="font-size: 12px; color: #666; word-break: break-all; margin: 5px 0;">${url}</div>
                    <p id="status-${formatName.replace(/\s+/g, '-').toLowerCase()}">Test ediliyor...</p>
                    <div id="image-container-${formatName.replace(/\s+/g, '-').toLowerCase()}"></div>
                `;
                
                container.appendChild(testDiv);
                
                const statusEl = document.getElementById(`status-${formatName.replace(/\s+/g, '-').toLowerCase()}`);
                const imgContainer = document.getElementById(`image-container-${formatName.replace(/\s+/g, '-').toLowerCase()}`);
                
                const img = new Image();
                img.style.cssText = 'max-width: 200px; max-height: 200px; border: 2px solid #ddd; border-radius: 5px; margin-top: 10px;';
                
                const startTime = Date.now();
                
                img.onload = function() {
                    const loadTime = Date.now() - startTime;
                    img.style.borderColor = '#28a745';
                    statusEl.innerHTML = `âœ… BaÅŸarÄ±lÄ±! (${loadTime}ms)<br><small>${img.naturalWidth} x ${img.naturalHeight}px</small>`;
                    imgContainer.appendChild(img);
                    
                    if (isRecommended) {
                        showStatus(`âœ… Kapak gÃ¶rseli baÅŸarÄ±yla yÃ¼klendi! (${formatName})`, 'success');
                    }
                    resolve(true);
                };
                
                img.onerror = function() {
                    const loadTime = Date.now() - startTime;
                    img.style.borderColor = '#dc3545';
                    statusEl.innerHTML = `âŒ YÃ¼klenemedi (${loadTime}ms)<br><small>CORS veya eriÅŸim hatasÄ±</small>`;
                    
                    // Show error placeholder
                    img.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iI2Y4ZjlmYSIvPjx0ZXh0IHg9IjUwIiB5PSI1MCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjE0IiBmaWxsPSIjNmM3NTdkIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iMC4zZW0iPkVycm9yPC90ZXh0Pjwvc3ZnPg==';
                    imgContainer.appendChild(img);
                    resolve(false);
                };
                
                img.src = url;
                
                // Timeout after 10 seconds
                setTimeout(() => {
                    if (statusEl.textContent === 'Test ediliyor...') {
                        statusEl.innerHTML = 'â° Zaman aÅŸÄ±mÄ± (10s+)';
                        resolve(false);
                    }
                }, 10000);
            });
        }

        // Preview chapter images
        async function previewImages() {
            const imageInputs = document.querySelectorAll('#image-inputs input');
            const urls = Array.from(imageInputs).map(input => input.value).filter(url => url);
            
            if (urls.length === 0) {
                showStatus('LÃ¼tfen en az bir gÃ¶rsel linki girin', 'error');
                return;
            }

            toggleLoading(true);
            
            const previewContainer = document.getElementById('preview-images-container');
            previewContainer.innerHTML = '';
            
            // Convert URLs to proxy format and display images
            for (let i = 0; i < urls.length; i++) {
                const fileId = extractFileId(urls[i]);
                
                if (fileId) {
                    const proxyUrl = createProxyUrl(fileId);
                    
                    const imgContainer = document.createElement('div');
                    imgContainer.style.cssText = 'margin: 10px; text-align: center; border: 1px solid #ddd; padding: 10px; border-radius: 5px;';
                    
                    const img = document.createElement('img');
                    img.className = 'preview-image';
                    img.alt = `Sayfa ${i + 1}`;
                    img.style.cssText = 'max-width: 150px; border: 2px solid #28a745; border-radius: 5px;';
                    
                    const label = document.createElement('p');
                    label.innerHTML = `<strong>Sayfa ${i + 1}</strong><br><small>Proxy URL</small>`;
                    
                    img.onload = function() {
                        img.style.borderColor = '#28a745';
                        label.innerHTML = `<strong>Sayfa ${i + 1} âœ…</strong><br><small>${img.naturalWidth}x${img.naturalHeight}px</small>`;
                    };
                    
                    img.onerror = function() {
                        img.style.borderColor = '#dc3545';
                        img.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1zbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iI2Y4ZjlmYSIvPjx0ZXh0IHg9IjUwIiB5PSI1MCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjE0IiBmaWxsPSIjNmM3NTdkIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iMC4zZW0iPkVycm9yPC90ZXh0Pjwvc3ZnPg==';
                        label.innerHTML = `<strong>Sayfa ${i + 1} âŒ</strong><br><small>YÃ¼klenemedi</small>`;
                    };
                    
                    img.src = proxyUrl;
                    
                    imgContainer.appendChild(label);
                    imgContainer.appendChild(img);
                    previewContainer.appendChild(imgContainer);
                } else {
                    const errorDiv = document.createElement('div');
                    errorDiv.textContent = `Sayfa ${i + 1}: GeÃ§ersiz Google Drive link`;
                    errorDiv.style.color = 'red';
                    previewContainer.appendChild(errorDiv);
                }
            }
            
            document.getElementById('images-preview').style.display = 'block';
            toggleLoading(false);
        }

        // Form submissions
        document.getElementById('series-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);
            
            // Client-side validasyon
            if (!data.title || data.title.trim().length === 0) {
                showStatus('Seri baÅŸlÄ±ÄŸÄ± gerekli', 'error');
                return;
            }
            
            if (!data.seriesId || data.seriesId.trim().length === 0) {
                showStatus('Seri ID gerekli', 'error');
                return;
            }
            
            // Seri ID normalize et (sadece alfanumerik karakterler)
            data.seriesId = data.seriesId.toLowerCase().replace(/[^a-z0-9]/g, '');
            
            if (data.seriesId.length < 3) {
                showStatus('Seri ID en az 3 karakter olmalÄ±', 'error');
                return;
            }
            
            if (!data.coverImageUrl || data.coverImageUrl.trim().length === 0) {
                showStatus('Kapak gÃ¶rseli gerekli', 'error');
                return;
            }
            
            // Google Drive link kontrolÃ¼
            if (!data.coverImageUrl.includes('drive.google.com') || !data.coverImageUrl.includes('/file/d/')) {
                showStatus('GeÃ§erli bir Google Drive linki girin', 'error');
                return;
            }
            
            // Parse genre
            if (data.genre) {
                data.genre = data.genre.split(',').map(g => g.trim());
            }
            
            toggleLoading(true);
            
            try {
                const response = await fetch(`${API_BASE}/admin/create-series`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                
                if (result.success) {
                    showStatus('Seri baÅŸarÄ±yla oluÅŸturuldu!', 'success');
                    e.target.reset();
                    document.getElementById('cover-preview').style.display = 'none';
                } else {
                    // DetaylÄ± hata mesajÄ± gÃ¶ster
                    let errorMessage = result.error || 'Seri oluÅŸturulamadÄ±';
                    if (result.details && Array.isArray(result.details)) {
                        errorMessage += ':\n' + result.details.join('\n');
                    }
                    if (result.existingTitle) {
                        errorMessage += '\nMevcut seri: ' + result.existingTitle;
                    }
                    showStatus(errorMessage, 'error');
                }
            } catch (error) {
                showStatus('BaÄŸlantÄ± hatasÄ±', 'error');
                console.error('Series creation error:', error);
            }
            
            toggleLoading(false);
        });

        document.getElementById('chapter-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const imageInputs = document.querySelectorAll('#image-inputs input');
            const imageUrls = Array.from(imageInputs).map(input => input.value).filter(url => url);
            
            // Client-side validasyon
            if (!formData.get('seriesId') || formData.get('seriesId').trim().length === 0) {
                showStatus('Seri ID gerekli', 'error');
                return;
            }
            
            if (!formData.get('chapterNumber') || isNaN(parseInt(formData.get('chapterNumber')))) {
                showStatus('GeÃ§erli bir bÃ¶lÃ¼m numarasÄ± gerekli', 'error');
                return;
            }
            
            if (parseInt(formData.get('chapterNumber')) <= 0) {
                showStatus('BÃ¶lÃ¼m numarasÄ± 0\'dan bÃ¼yÃ¼k olmalÄ±', 'error');
                return;
            }
            
            if (imageUrls.length === 0) {
                showStatus('LÃ¼tfen en az bir gÃ¶rsel linki girin', 'error');
                return;
            }
            
            // Google Drive linklerini kontrol et
            for (let i = 0; i < imageUrls.length; i++) {
                const url = imageUrls[i];
                if (!url.includes('drive.google.com') || !url.includes('/file/d/')) {
                    showStatus(`${i + 1}. gÃ¶rsel iÃ§in geÃ§erli bir Google Drive linki girin`, 'error');
                    return;
                }
            }
            
            const data = {
                seriesId: formData.get('seriesId').toLowerCase().replace(/[^a-z0-9]/g, ''),
                chapterNumber: parseInt(formData.get('chapterNumber')),
                title: formData.get('title') || `BÃ¶lÃ¼m ${formData.get('chapterNumber')}`,
                imageUrls: imageUrls
            };
            
            toggleLoading(true);
            
            try {
                const response = await fetch(`${API_BASE}/admin/create-chapter-with-images`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                
                if (result.success) {
                    showStatus(`BÃ¶lÃ¼m baÅŸarÄ±yla oluÅŸturuldu! (${result.imageCount} gÃ¶rsel)`, 'success');
                    e.target.reset();
                    document.getElementById('image-inputs').innerHTML = `
                        <div class="image-input-item">
                            <input type="url" placeholder="Sayfa 1 Google Drive linki" required>
                            <button type="button" class="btn btn-danger btn-small" onclick="removeImageInput(this)">Sil</button>
                        </div>
                    `;
                    document.getElementById('images-preview').style.display = 'none';
                } else {
                    // DetaylÄ± hata mesajÄ± gÃ¶ster
                    let errorMessage = result.error || 'BÃ¶lÃ¼m oluÅŸturulamadÄ±';
                    if (result.details && Array.isArray(result.details)) {
                        errorMessage += ':\n' + result.details.join('\n');
                    }
                    if (result.validIds && Array.isArray(result.validIds)) {
                        errorMessage += '\nGeÃ§erli seri ID\'leri: ' + result.validIds.join(', ');
                    }
                    showStatus(errorMessage, 'error');
                }
            } catch (error) {
                showStatus('BaÄŸlantÄ± hatasÄ±', 'error');
                console.error('Chapter creation error:', error);
            }
            
            toggleLoading(false);
        });

        document.getElementById('validate-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const driveUrl = formData.get('driveUrl');
            
            toggleLoading(true);
            
            try {
                const response = await fetch(`${API_BASE}/admin/validate-drive-link`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${getAuthToken()}`
                    },
                    body: JSON.stringify({ driveUrl })
                });

                const result = await response.json();
                
                const resultDiv = document.getElementById('validation-details');
                resultDiv.innerHTML = `
                    <p><strong>GeÃ§erli:</strong> ${result.isValid ? 'âœ… Evet' : 'âŒ HayÄ±r'}</p>
                    <p><strong>Direct URL:</strong> <a href="${result.directUrl}" target="_blank">${result.directUrl}</a></p>
                    <p><strong>Thumbnail URL:</strong> <a href="${result.thumbnailUrl}" target="_blank">${result.thumbnailUrl}</a></p>
                    ${result.isValid ? `<img src="${result.directUrl}" class="preview-image" style="max-width: 300px; margin-top: 15px;">` : ''}
                `;
                
                document.getElementById('validation-result').style.display = 'block';
                
                showStatus(result.isValid ? 'Link geÃ§erli!' : 'Link geÃ§ersiz!', result.isValid ? 'success' : 'error');
            } catch (error) {
                showStatus('DoÄŸrulama hatasÄ±', 'error');
                console.error('Validation error:', error);
            }
            
            toggleLoading(false);
        });

        // Auto-generate series ID from title
        document.getElementById('series-title').addEventListener('input', (e) => {
            const title = e.target.value;
            const seriesId = title.toLowerCase()
                .replace(/[^a-z0-9\s]/g, '')
                .replace(/\s+/g, '');
            document.getElementById('series-id').value = seriesId;
        });

        // BÃ¶lÃ¼m YÃ¶netimi FonksiyonlarÄ±
        async function loadSeriesList() {
            try {
                const response = await fetch(`${API_BASE}/admin/series-list`);
                const series = await response.json();
                
                const select = document.getElementById('manage-series');
                select.innerHTML = '<option value="">-- Seri SeÃ§in --</option>';
                
                series.forEach(s => {
                    const option = document.createElement('option');
                    option.value = s.seriesId;
                    option.textContent = `${s.title} (${s.chapterCount} bÃ¶lÃ¼m)`;
                    select.appendChild(option);
                });
                
            } catch (error) {
                showStatus('Seriler yÃ¼klenirken hata oluÅŸtu', 'error');
                console.error('Load series error:', error);
            }
        }

        // Yeni BÃ¶lÃ¼m Ekleme iÃ§in serileri yÃ¼kle
        async function loadChapterSeriesList() {
            try {
                const response = await fetch(`${API_BASE}/admin/series-list`);
                const series = await response.json();
                
                const select = document.getElementById('chapter-series');
                select.innerHTML = '<option value="">-- Seri SeÃ§in --</option>';
                
                series.forEach(s => {
                    const option = document.createElement('option');
                    option.value = s.seriesId;
                    option.textContent = `${s.title} (${s.chapterCount} bÃ¶lÃ¼m)`;
                    select.appendChild(option);
                });
                
            } catch (error) {
                showStatus('Seriler yÃ¼klenirken hata oluÅŸtu', 'error');
                console.error('Load chapter series error:', error);
            }
        }

        async function loadSeriesChapters(seriesId) {
            if (!seriesId) {
                document.getElementById('chapters-list-container').style.display = 'none';
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/admin/series/${seriesId}/chapters`);
                const data = await response.json();
                
                if (data.success) {
                    displayChaptersList(data.chapters, seriesId);
                    document.getElementById('chapters-list-container').style.display = 'block';
                } else {
                    showStatus('BÃ¶lÃ¼mler yÃ¼klenirken hata oluÅŸtu', 'error');
                }
                
            } catch (error) {
                showStatus('BÃ¶lÃ¼mler yÃ¼klenirken hata oluÅŸtu', 'error');
                console.error('Load chapters error:', error);
            }
        }

        function displayChaptersList(chapters, seriesId) {
            const container = document.getElementById('chapters-list');
            
            if (!chapters || chapters.length === 0) {
                container.innerHTML = '<p class="no-chapters">Bu seride henÃ¼z bÃ¶lÃ¼m yok.</p>';
                return;
            }

            const chaptersHtml = chapters.map(chapter => `
                <div class="chapter-card">
                    <h4>BÃ¶lÃ¼m ${chapter.number}: ${chapter.title || 'BaÅŸlÄ±ksÄ±z'}</h4>
                    <div class="chapter-info">
                        ğŸ“… ${new Date(chapter.uploadDate).toLocaleDateString('tr-TR')}<br>
                        ğŸ–¼ï¸ ${chapter.imageCount} gÃ¶rsel<br>
                        ğŸ“ ${chapter.filename}
                    </div>
                    <div class="chapter-actions">
                        <button class="btn btn-small" onclick="editChapter('${seriesId}', ${chapter.number})">âœï¸ DÃ¼zenle</button>
                        <button class="btn btn-danger btn-small" onclick="confirmDeleteChapter('${seriesId}', ${chapter.number})">ğŸ—‘ï¸ Sil</button>
                    </div>
                </div>
            `).join('');

            container.innerHTML = `<div class="chapters-grid">${chaptersHtml}</div>`;
        }

        async function editChapter(seriesId, chapterNumber) {
            try {
                const response = await fetch(`${API_BASE}/admin/series/${seriesId}/chapters/${chapterNumber}`);
                const data = await response.json();
                
                if (data.success) {
                    showEditForm(data.chapter, seriesId);
                } else {
                    showStatus('BÃ¶lÃ¼m bilgileri alÄ±namadÄ±', 'error');
                }
                
            } catch (error) {
                showStatus('BÃ¶lÃ¼m bilgileri alÄ±nÄ±rken hata oluÅŸtu', 'error');
                console.error('Edit chapter error:', error);
            }
        }

        function showEditForm(chapter, seriesId) {
            document.getElementById('edit-series-id').value = seriesId;
            document.getElementById('edit-chapter-original-number').value = chapter.number;
            document.getElementById('edit-chapter-number').value = chapter.number;
            document.getElementById('edit-chapter-title').value = chapter.title || '';
            
            // GÃ¶rsel URL'lerini yÃ¼kle
            const imageContainer = document.getElementById('edit-image-inputs');
            imageContainer.innerHTML = '';
            
            if (chapter.imageUrls && chapter.imageUrls.length > 0) {
                chapter.imageUrls.forEach((url, index) => {
                    addEditImageInput(url);
                });
            } else {
                addEditImageInput();
            }
            
            document.getElementById('chapter-edit-form').style.display = 'block';
            document.getElementById('chapter-edit-form').scrollIntoView({ behavior: 'smooth' });
        }

        function addEditImageInput(url = '') {
            const container = document.getElementById('edit-image-inputs');
            const inputCount = container.children.length;
            
            const newInputDiv = document.createElement('div');
            newInputDiv.className = 'edit-image-input-item';
            newInputDiv.innerHTML = `
                <input type="url" placeholder="Sayfa ${inputCount + 1} Google Drive linki" value="${url}" oninput="updateImagePreview(this)">
                <button type="button" class="btn btn-danger btn-small" onclick="removeEditImageInput(this)">Sil</button>
                <img src="${url ? getPreviewUrl(url) : ''}" class="image-preview" style="max-width:60px; max-height:60px; vertical-align:middle; margin-left:8px; display:${url ? 'inline-block' : 'none'};" onclick="showImageModal(this.src)" title="Ã–nizle">
            `;
            container.appendChild(newInputDiv);
        }

        function getPreviewUrl(url) {
            // Google Drive linkinden fileId Ã§Ä±karÄ±p thumbnail oluÅŸtur
            const fileId = extractFileId(url);
            if (fileId) {
                return `https://drive.google.com/thumbnail?id=${fileId}&sz=s400`;
            }
            return url;
        }

        function updateImagePreview(input) {
            const url = input.value;
            const img = input.parentElement.querySelector('.image-preview');
            if (url) {
                img.src = getPreviewUrl(url);
                img.style.display = 'inline-block';
            } else {
                img.src = '';
                img.style.display = 'none';
            }
        }

        function showImageModal(src) {
            // Basit modal: yeni sekmede aÃ§
            window.open(src, '_blank');
        }

        function cancelEdit() {
            document.getElementById('chapter-edit-form').style.display = 'none';
        }

        async function confirmDeleteChapter(seriesId, chapterNumber) {
            if (confirm(`BÃ¶lÃ¼m ${chapterNumber}'Ã¼ silmek istediÄŸinizden emin misiniz? Bu iÅŸlem geri alÄ±namaz.`)) {
                await deleteChapterConfirmed(seriesId, chapterNumber);
            }
        }

        async function deleteChapterConfirmed(seriesId, chapterNumber) {
            toggleLoading(true);
            
            try {
                const response = await fetch(`${API_BASE}/moderator/delete-chapter/${seriesId}/${chapterNumber}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }
                
                const result = await response.json();
                
                if (result.success) {
                    showStatus('BÃ¶lÃ¼m baÅŸarÄ±yla silindi!', 'success');
                    loadSeriesChapters(seriesId); // Listeyi yenile
                } else {
                    showStatus(result.error || 'BÃ¶lÃ¼m silinemedi', 'error');
                }
                
            } catch (error) {
                showStatus('BÃ¶lÃ¼m silinirken hata oluÅŸtu', 'error');
                console.error('Delete chapter error:', error);
            }
            
            toggleLoading(false);
        }

        async function deleteChapter() {
            const seriesId = document.getElementById('edit-series-id').value;
            const chapterNumber = document.getElementById('edit-chapter-original-number').value;
            await confirmDeleteChapter(seriesId, chapterNumber);
        }

        // Edit Chapter Form Submit
        document.getElementById('edit-chapter-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const imageInputs = document.querySelectorAll('#edit-image-inputs input');
            const imageUrls = Array.from(imageInputs).map(input => input.value).filter(url => url);
            
            if (imageUrls.length === 0) {
                showStatus('LÃ¼tfen en az bir gÃ¶rsel linki girin', 'error');
                return;
            }
            
            const data = {
                seriesId: document.getElementById('edit-series-id').value,
                originalChapterNumber: document.getElementById('edit-chapter-original-number').value,
                newChapterNumber: document.getElementById('edit-chapter-number').value,
                title: document.getElementById('edit-chapter-title').value,
                imageUrls: imageUrls
            };
            
            toggleLoading(true);
            
            try {
                const response = await fetch(`${API_BASE}/admin/update-chapter`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                
                if (result.success) {
                    showStatus('BÃ¶lÃ¼m baÅŸarÄ±yla gÃ¼ncellendi!', 'success');
                    cancelEdit();
                    loadSeriesChapters(data.seriesId); // Listeyi yenile
                } else {
                    showStatus(result.error || 'BÃ¶lÃ¼m gÃ¼ncellenemedi', 'error');
                }
            } catch (error) {
                showStatus('BaÄŸlantÄ± hatasÄ±', 'error');
                console.error('Update chapter error:', error);
            }
            
            toggleLoading(false);
        });

        // Seri Silme FonksiyonlarÄ±
        document.getElementById('confirm-delete').addEventListener('input', function() {
            const deleteBtn = document.getElementById('delete-btn');
            deleteBtn.disabled = this.value !== 'SÄ°L';
        });

        async function deleteSeries() {
            const seriesId = document.getElementById('delete-series').value;
            const confirmText = document.getElementById('confirm-delete').value.toUpperCase();
            if (!seriesId) {
                showStatus('LÃ¼tfen silinecek seriyi seÃ§in', 'error');
                return;
            }
            if (confirmText !== 'SÄ°L') {
                showStatus('Silme iÅŸlemini onaylamak iÃ§in "SÄ°L" yazÄ±n', 'error');
                return;
            }
            const seriesTitle = document.getElementById('delete-series').selectedOptions[0].textContent;
            if (!confirm(`"${seriesTitle}" serisini silmek istediÄŸinizden emin misiniz? Bu iÅŸlem geri alÄ±namaz!`)) {
                return;
            }
            toggleLoading(true);
            document.getElementById('delete-result').style.display = 'none';
            try {
                // EÄŸer backend auth isterse token ekleyin:
                // const token = getAuthToken();
                const response = await fetch(`${API_BASE}/admin/delete-series/${seriesId}`, {
                    method: 'DELETE',
                    // headers: { 'Authorization': `Bearer ${token}` }
                });
                let result;
                try {
                    result = await response.json();
                } catch (jsonErr) {
                    showStatus('Sunucudan geÃ§ersiz yanÄ±t alÄ±ndÄ±', 'error');
                    toggleLoading(false);
                    return;
                }
                if (result && result.success) {
                    showStatus(`"${result.deletedSeries.title}" serisi baÅŸarÄ±yla silindi!`, 'success');
                    document.getElementById('delete-series').value = '';
                    document.getElementById('confirm-delete').value = '';
                    document.getElementById('delete-btn').disabled = true;
                    document.getElementById('delete-btn').style.opacity = '0.5';
                    const resultDiv = document.getElementById('delete-result');
                    const detailsDiv = document.getElementById('delete-details');
                    detailsDiv.innerHTML = `
                        <div style="color: green;">
                            <strong>âœ… BaÅŸarÄ±yla silindi:</strong><br>
                            ğŸ“š Seri: ${result.deletedSeries.title}<br>
                            ğŸ”— ID: ${result.deletedSeries.seriesId}<br>
                            ğŸ“ KlasÃ¶rler ve dosyalar temizlendi<br>
                            ğŸ—„ï¸ VeritabanÄ± kayÄ±tlarÄ± silindi
                        </div>
                    `;
                    resultDiv.style.display = 'block';
                    loadDeleteSeriesList();
                } else {
                    showStatus(result && result.error ? result.error : 'Seri silinemedi', 'error');
                }
            } catch (error) {
                showStatus(`Seri silinirken hata oluÅŸtu: ${error.message}`, 'error');
            }
            toggleLoading(false);
        }

        // Delete tab iÃ§in serileri yÃ¼kle
        async function loadDeleteSeriesList() {
            try {
                console.log('Loading series list...');
                const response = await fetch('data/manhwalar.json');
                console.log('Response status:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const seriesList = await response.json();
                console.log('Series loaded:', seriesList.length);
                
                const selectElement = document.getElementById('delete-series');
                selectElement.innerHTML = '<option value="">-- Seri SeÃ§in --</option>';
                
                seriesList.forEach(series => {
                    const option = document.createElement('option');
                    option.value = series.seriesId;
                    option.textContent = `${series.title} (${series.seriesId})`;
                    selectElement.appendChild(option);
                });
                
                console.log('Series list loaded successfully');
            } catch (error) {
                console.error('Error loading series list:', error);
                showStatus(`Seri listesi yÃ¼klenirken hata oluÅŸtu: ${error.message}`, 'error');
            }
        }

        // Silme onayÄ± kontrolÃ¼
        document.getElementById('confirm-delete').addEventListener('input', function() {
            const confirmText = this.value.toUpperCase();
            const deleteBtn = document.getElementById('delete-btn');
            const seriesSelected = document.getElementById('delete-series').value;
            
            if (confirmText === 'SÄ°L' && seriesSelected) {
                deleteBtn.disabled = false;
                deleteBtn.style.opacity = '1';
            } else {
                deleteBtn.disabled = true;
                deleteBtn.style.opacity = '0.5';
            }
        });

        // Seri DÃ¼zenleme FonksiyonlarÄ±
        
        // Edit sekmesi iÃ§in seri listesini yÃ¼kle
        async function loadEditSeriesList() {
            try {
                const response = await fetch('https://toonnekoauth-api.onrender.com/client/data/manhwalar.json');
                const series = await response.json();
                
                const select = document.getElementById('edit-series-select');
                select.innerHTML = '<option value="">-- Seri SeÃ§in --</option>';
                
                series.forEach(serie => {
                    const option = document.createElement('option');
                    option.value = serie.seriesId;
                    option.textContent = serie.title;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('Seri listesi yÃ¼klenirken hata:', error);
                showStatus('Seri listesi yÃ¼klenemedi', 'error');
            }
        }

        // Etiket ayarlarÄ± gÃ¶rÃ¼nÃ¼rlÃ¼k kontrolÃ¼
        function toggleLabelSettings() {
            const labelValue = document.getElementById('edit-series-label-enabled').value;
            const labelSettings = document.getElementById('label-settings');
            
            // Sadece "true" (Etiketi GÃ¶ster) durumunda ayarlarÄ± gÃ¶ster
            labelSettings.style.display = labelValue === 'true' ? 'block' : 'none';
            updateLabelPreview();
        }

        // Etiket Ã¶nizleme gÃ¼ncelleme
        function updateLabelPreview() {
            const labelValue = document.getElementById('edit-series-label-enabled').value;
            const text = document.getElementById('edit-series-label-text').value;
            const color = document.getElementById('edit-series-label-color').value;
            const preview = document.getElementById('label-preview-badge');
            
            if (labelValue === 'true') {
                // Etiketi gÃ¶ster
                preview.textContent = text;
                preview.style.background = color;
                preview.style.display = 'inline-block';
            } else if (labelValue === 'false') {
                // Etiket var ama gizli (Ã¶nizlemede gÃ¶ster ama soluk)
                preview.textContent = text + ' (Gizli)';
                preview.style.background = color;
                preview.style.opacity = '0.5';
                preview.style.display = 'inline-block';
            } else {
                // Etiket yok
                preview.style.display = 'none';
                preview.style.opacity = '1';
            }
        }

        // SeÃ§ilen seriyi dÃ¼zenleme formuna yÃ¼kle
        async function loadSeriesForEdit() {
            const seriesId = document.getElementById('edit-series-select').value;
            const formContainer = document.getElementById('edit-series-form-container');
            
            if (!seriesId) {
                formContainer.style.display = 'none';
                return;
            }

            try {
                const response = await fetch('https://toonnekoauth-api.onrender.com/client/data/manhwalar.json');
                const series = await response.json();
                const selectedSeries = series.find(s => s.seriesId === seriesId);

                if (!selectedSeries) {
                    showStatus('Seri bulunamadÄ±', 'error');
                    return;
                }

                // Form alanlarÄ±nÄ± doldur
                document.getElementById('edit-series-title').value = selectedSeries.title || '';
                document.getElementById('edit-series-status').value = selectedSeries.status || 'Devam Ediyor';
                document.getElementById('edit-series-summary').value = selectedSeries.summary || '';
                document.getElementById('edit-series-cover').value = selectedSeries.image || '';
                document.getElementById('edit-series-author').value = selectedSeries.author || '';
                document.getElementById('edit-series-artist').value = selectedSeries.artist || '';
                document.getElementById('edit-series-publisher').value = selectedSeries.publisher || '';
                
                // Genres array'ini virgÃ¼lle ayrÄ±lmÄ±ÅŸ string'e Ã§evir
                const genresString = selectedSeries.genres ? selectedSeries.genres.join(', ') : '';
                document.getElementById('edit-series-genres').value = genresString;

                // Etiket bilgilerini yÃ¼kle
                const label = selectedSeries.label;
                let labelStatus = 'none'; // VarsayÄ±lan: Etiket yok
                
                if (label) {
                    if (label.enabled === true) {
                        labelStatus = 'true'; // Etiketi gÃ¶ster
                    } else if (label.enabled === false) {
                        labelStatus = 'false'; // Etiketi gizle
                    }
                    // Etiket var ise text ve color'Ä± yÃ¼kle
                    document.getElementById('edit-series-label-text').value = label.text || 'Yeni';
                    document.getElementById('edit-series-label-color').value = label.color || '#4CAF50';
                } else {
                    // Etiket yok ise varsayÄ±lan deÄŸerler
                    document.getElementById('edit-series-label-text').value = 'Yeni';
                    document.getElementById('edit-series-label-color').value = '#4CAF50';
                }
                
                document.getElementById('edit-series-label-enabled').value = labelStatus;
                toggleLabelSettings();

                // Kapak Ã¶nizlemesini gÃ¶ster
                if (selectedSeries.image) {
                    document.getElementById('edit-preview-image').src = selectedSeries.image;
                    document.getElementById('edit-cover-preview').style.display = 'block';
                }

                formContainer.style.display = 'block';
            } catch (error) {
                console.error('Seri yÃ¼klenirken hata:', error);
                showStatus('Seri bilgileri yÃ¼klenemedi', 'error');
            }
        }

        // Kapak gÃ¶rselini doÄŸrula (dÃ¼zenleme formu iÃ§in)
        function validateEditCoverImage() {
            const url = document.getElementById('edit-series-cover').value;
            const previewContainer = document.getElementById('edit-cover-preview');
            const previewImage = document.getElementById('edit-preview-image');

            if (!url) {
                showStatus('LÃ¼tfen bir gÃ¶rsel URL\'si girin', 'error');
                previewContainer.style.display = 'none';
                return;
            }

            // Google Drive linkini proxy URL'ye dÃ¶nÃ¼ÅŸtÃ¼r
            let imageUrl = url;
            const driveMatch = url.match(/\/file\/d\/([a-zA-Z0-9_-]+)/);
            if (driveMatch) {
                const fileId = driveMatch[1];
                imageUrl = `https://toonnekoauth-api.onrender.com/image/proxy-image/${fileId}`;
            }

            // Loading gÃ¶ster
            previewImage.src = '';
            previewContainer.style.display = 'block';
            previewImage.style.display = 'none';
            
            // Temporary loading message
            const loadingMsg = document.createElement('div');
            loadingMsg.innerHTML = 'ğŸ”„ GÃ¶rsel yÃ¼kleniyor...';
            loadingMsg.style.padding = '20px';
            loadingMsg.style.textAlign = 'center';
            loadingMsg.id = 'temp-loading';
            previewContainer.appendChild(loadingMsg);

            previewImage.onload = function() {
                const tempLoading = document.getElementById('temp-loading');
                if (tempLoading) tempLoading.remove();
                
                previewImage.style.display = 'block';
                showStatus('GÃ¶rsel baÅŸarÄ±yla yÃ¼klendi', 'success');
            };
            
            previewImage.onerror = function() {
                const tempLoading = document.getElementById('temp-loading');
                if (tempLoading) tempLoading.remove();
                
                previewContainer.style.display = 'none';
                showStatus('GÃ¶rsel yÃ¼klenemedi. URL\'yi kontrol edin', 'error');
            };
            
            previewImage.src = imageUrl;
        }

        // DÃ¼zenleme formunu temizle ve gizle
        function cancelEdit() {
            document.getElementById('edit-series-select').value = '';
            document.getElementById('edit-series-form-container').style.display = 'none';
            document.getElementById('edit-cover-preview').style.display = 'none';
            document.getElementById('edit-series-form').reset();
        }

        // Seri dÃ¼zenleme form submit
        document.getElementById('edit-series-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const seriesId = document.getElementById('edit-series-select').value;
            if (!seriesId) {
                showStatus('LÃ¼tfen bir seri seÃ§in', 'error');
                return;
            }

            // Loading gÃ¶ster
            showLoading(true);
            
            // Status mesajÄ±nÄ± temizle
            const statusDiv = document.getElementById('status-message');
            statusDiv.style.display = 'none';

            try {
                // Form verilerini manuel olarak topla
                const editData = {
                    seriesId: seriesId,
                    title: document.getElementById('edit-series-title').value,
                    status: document.getElementById('edit-series-status').value,
                    summary: document.getElementById('edit-series-summary').value,
                    image: document.getElementById('edit-series-cover').value,
                    author: document.getElementById('edit-series-author').value,
                    artist: document.getElementById('edit-series-artist').value,
                    publisher: document.getElementById('edit-series-publisher').value,
                    genres: document.getElementById('edit-series-genres').value.split(',').map(g => g.trim()).filter(g => g)
                };

                // Etiket iÅŸleme
                const labelValue = document.getElementById('edit-series-label-enabled').value;
                if (labelValue === 'none') {
                    // Etiket tamamen kaldÄ±r
                    editData.removeLabel = true;
                } else {
                    // Etiket ekle/gÃ¼ncelle
                    editData.label = {
                        enabled: labelValue === 'true',
                        text: document.getElementById('edit-series-label-text').value,
                        color: document.getElementById('edit-series-label-color').value
                    };
                }

                // Zorunlu alanlarÄ± kontrol et
                if (!editData.title || !editData.status || !editData.image) {
                    showLoading(false);
                    showStatus('LÃ¼tfen tÃ¼m zorunlu alanlarÄ± doldurun (BaÅŸlÄ±k, Durum, Kapak GÃ¶rseli)', 'error');
                    return;
                }

                // Google Drive linkini proxy URL'ye dÃ¶nÃ¼ÅŸtÃ¼r
                const driveMatch = editData.image.match(/\/file\/d\/([a-zA-Z0-9_-]+)/);
                if (driveMatch) {
                    const fileId = driveMatch[1];
                    editData.image = `https://toonnekoauth-api.onrender.com/api/image/proxy-image/${fileId}`;
                }

                console.log('GÃ¶nderilen veri:', editData); // Debug iÃ§in

                const response = await fetch('https://toonnekoauth-api.onrender.com/api/manhwa/edit', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(editData)
                });

                const result = await response.json();
                console.log('Sunucu yanÄ±tÄ±:', result); // Debug iÃ§in

                if (response.ok) {
                    showStatus('Seri baÅŸarÄ±yla gÃ¼ncellendi!', 'success');
                    // Edit sekmesindeki seri listesini yenile
                    loadEditSeriesList();
                    // SeÃ§ili seriyi yeniden yÃ¼kle
                    loadSeriesForEdit();
                } else {
                    showStatus(result.error || 'Seri gÃ¼ncellenirken hata oluÅŸtu', 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showStatus('Beklenmeyen bir hata oluÅŸtu: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        });

        // GÃ¶rsel URL alanÄ±nda deÄŸiÅŸiklik olduÄŸunda otomatik Ã¶nizleme
        document.getElementById('edit-series-cover').addEventListener('input', function() {
            // 1 saniye bekle sonra otomatik doÄŸrula
            clearTimeout(this.previewTimeout);
            this.previewTimeout = setTimeout(() => {
                if (this.value.trim()) {
                    validateEditCoverImage();
                }
            }, 1000);
        });

        // Seri seÃ§imi deÄŸiÅŸtiÄŸinde onay kontrolÃ¼
        document.getElementById('delete-series').addEventListener('change', function() {
            const confirmText = document.getElementById('confirm-delete').value.toUpperCase();
            const deleteBtn = document.getElementById('delete-btn');
            
            if (confirmText === 'SÄ°L' && this.value) {
                deleteBtn.disabled = false;
                deleteBtn.style.opacity = '1';
            } else {
                deleteBtn.disabled = true;
                deleteBtn.style.opacity = '0.5';
            }
        });

        // ===== KULLANICI YÃ–NETÄ°MÄ° FONKSÄ°YONLARI =====
        
        let allUsers = [];

        // KullanÄ±cÄ±larÄ± yÃ¼kle
        async function loadUsers() {
            try {
                console.log('KullanÄ±cÄ±larÄ± yÃ¼klemeye Ã§alÄ±ÅŸÄ±yor...');

                // Test endpoint kullan (geÃ§ici Ã§Ã¶zÃ¼m)
                const response = await fetch('https://toonnekoauth-api.onrender.com/api/admin/test-users', {
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                console.log('Response status:', response.status);
                console.log('Response ok:', response.ok);

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('Server error response:', errorText);
                    throw new Error(`Server error ${response.status}: ${errorText}`);
                }

                const data = await response.json();
                console.log('Response data:', JSON.stringify(data, null, 2));
                
                // API direkt kullanÄ±cÄ± array'i dÃ¶ndÃ¼rÃ¼yor
                if (Array.isArray(data)) {
                    allUsers = data;
                    renderUsers(allUsers);
                    updateUserStats(allUsers);
                } else if (data.success) {
                    allUsers = data.users;
                    renderUsers(allUsers);
                    updateUserStats(allUsers);
                } else {
                    throw new Error(data.error || data.details || 'KullanÄ±cÄ±lar yÃ¼klenemedi');
                }
            } catch (error) {
                console.error('KullanÄ±cÄ±larÄ± yÃ¼kleme hatasÄ±:', error);
                document.getElementById('users-loading').innerHTML = `
                    <div style="color: #dc3545; font-size: 16px;">
                        âŒ KullanÄ±cÄ±lar yÃ¼klenemedi: ${error.message}
                        <br><small>Detaylar iÃ§in tarayÄ±cÄ± console'unu kontrol edin.</small>
                    </div>
                `;
            }
        }

        // KullanÄ±cÄ± istatistiklerini gÃ¼ncelle
        function updateUserStats(users) {
            const totalUsers = users.length;
            const adminUsers = users.filter(u => u.isAdmin).length;
            const moderatorUsers = users.filter(u => u.isModerator).length;
            const blockedUsers = users.filter(u => u.isBlocked).length;

            document.getElementById('total-users-count').textContent = totalUsers;
            document.getElementById('admin-users-count').textContent = adminUsers;
            document.getElementById('moderator-users-count').textContent = moderatorUsers;
            document.getElementById('blocked-users-count').textContent = blockedUsers;
        }

        // KullanÄ±cÄ±larÄ± render et
        function renderUsers(users) {
            const container = document.getElementById('users-list');
            const loadingDiv = document.getElementById('users-loading');
            
            loadingDiv.style.display = 'none';
            container.style.display = 'block';

            if (users.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #666; padding: 40px;">KullanÄ±cÄ± bulunamadÄ±</div>';
                return;
            }

            const usersHTML = users.map(user => {
                const statusBadges = [];
                if (user.isAdmin) statusBadges.push('<span style="background: #28a745; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px; margin-left: 8px;">Admin</span>');
                if (user.isModerator) statusBadges.push('<span style="background: #ffc107; color: black; padding: 4px 8px; border-radius: 12px; font-size: 12px; margin-left: 8px;">ModeratÃ¶r</span>');
                if (user.isBlocked) statusBadges.push('<span style="background: #dc3545; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px; margin-left: 8px;">Engelli</span>');
                
                return `
                    <div class="user-card" style="background: #f8f9fa; border-radius: 10px; padding: 20px; margin-bottom: 15px; border-left: 4px solid ${user.isAdmin ? '#28a745' : user.isModerator ? '#ffc107' : user.isBlocked ? '#dc3545' : '#667eea'};">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h4 style="margin-bottom: 8px;">
                                    ğŸ‘¤ ${user.username}
                                    ${statusBadges.join('')}
                                </h4>
                                <p style="color: #666; margin-bottom: 8px;">ğŸ“§ ${user.email}</p>
                                <div style="font-size: 14px; color: #888;">
                                    <span>ğŸ“… KayÄ±t: ${new Date(user.createdAt).toLocaleDateString('tr-TR')}</span>
                                    <span style="margin-left: 20px;">â­ ${user.ratings ? user.ratings.length : 0} puan</span>
                                    <span style="margin-left: 20px;">â¤ï¸ ${user.favorites ? user.favorites.length : 0} favori</span>
                                    <span style="margin-left: 20px;">ğŸ“– ${user.readSeries ? user.readSeries.length : 0} okunan</span>
                                    ${user.isModerator ? `<span style="margin-left: 20px;">ğŸ›¡ï¸ ${user.moderatorSeries ? user.moderatorSeries.length : 0} seri</span>` : ''}
                                </div>
                            </div>
                            <div style="display: flex; gap: 10px;">
                                <button onclick="viewUserDetails('${user._id}')" style="background: #17a2b8; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer;">ğŸ‘ï¸ Detay</button>
                                <button onclick="toggleUserAdmin('${user._id}', ${!user.isAdmin})" 
                                        style="background: ${user.isAdmin ? '#6c757d' : '#28a745'}; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer;">
                                    ${user.isAdmin ? 'ğŸ‘¤ Admin Al' : 'â­ Admin Yap'}
                                </button>
                                <button onclick="toggleUserBlock('${user._id}', ${!user.isBlocked})" 
                                        style="background: ${user.isBlocked ? '#28a745' : '#ffc107'}; color: ${user.isBlocked ? 'white' : 'black'}; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer;">
                                    ${user.isBlocked ? 'âœ… Engel KaldÄ±r' : 'ğŸš« Engelle'}
                                </button>
                                <button onclick="deleteUser('${user._id}', '${user.username}')" style="background: #dc3545; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer;">ğŸ—‘ï¸ Sil</button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = usersHTML;
        }

        // KullanÄ±cÄ± arama
        function filterUsers() {
            const searchTerm = document.getElementById('user-search').value.toLowerCase();
            const filteredUsers = allUsers.filter(user => 
                user.username.toLowerCase().includes(searchTerm) || 
                user.email.toLowerCase().includes(searchTerm)
            );
            renderUsers(filteredUsers);
        }

        // Admin yetkisi deÄŸiÅŸtir - GEÃ‡Ä°CÄ° MOCK
        async function toggleUserAdmin(userId, makeAdmin) {
            if (!confirm(`Bu kullanÄ±cÄ±yÄ± ${makeAdmin ? 'admin yapmak' : 'admin yetkisini almak'} istediÄŸinizden emin misiniz?`)) {
                return;
            }

            try {
                // GEÃ‡Ä°CÄ°: Mock response dÃ¶ndÃ¼r
                console.log(`ğŸ”§ Mock iÅŸlem: KullanÄ±cÄ± ${userId} ${makeAdmin ? 'admin yapÄ±ldÄ±' : 'admin yetkisi kaldÄ±rÄ±ldÄ±'}`);
                alert(`KullanÄ±cÄ± ${makeAdmin ? 'admin yapÄ±ldÄ±' : 'admin yetkisi kaldÄ±rÄ±ldÄ±'} (Mock iÅŸlem)`);
                await loadUsers(); // Listeyi yenile
            } catch (error) {
                console.error('Mock admin iÅŸlemi hatasÄ±:', error);
                alert('Hata: ' + error.message);
            }
        }

        // KullanÄ±cÄ± engelleme - GEÃ‡Ä°CÄ° MOCK
        async function toggleUserBlock(userId, blockUser) {
            if (!confirm(`Bu kullanÄ±cÄ±yÄ± ${blockUser ? 'engellemek' : 'engel kaldÄ±rmak'} istediÄŸinizden emin misiniz?`)) {
                return;
            }

            try {
                // GEÃ‡Ä°CÄ°: Mock response dÃ¶ndÃ¼r
                console.log(`ğŸ”§ Mock iÅŸlem: KullanÄ±cÄ± ${userId} ${blockUser ? 'engellendi' : 'engeli kaldÄ±rÄ±ldÄ±'}`);
                alert(`KullanÄ±cÄ± ${blockUser ? 'engellendi' : 'engeli kaldÄ±rÄ±ldÄ±'} (Mock iÅŸlem)`);
                await loadUsers(); // Listeyi yenile
            } catch (error) {
                console.error('Mock block iÅŸlemi hatasÄ±:', error);
                alert('Hata: ' + error.message);
            }
        }

        // KullanÄ±cÄ± silme - GEÃ‡Ä°CÄ° MOCK
        async function deleteUser(userId, username) {
            if (!confirm(`"${username}" kullanÄ±cÄ±sÄ±nÄ± kalÄ±cÄ± olarak silmek istediÄŸinizden emin misiniz?\n\nBu iÅŸlem geri alÄ±namaz!`)) {
                return;
            }

            try {
                // GEÃ‡Ä°CÄ°: Mock response dÃ¶ndÃ¼r
                console.log(`ğŸ”§ Mock iÅŸlem: KullanÄ±cÄ± ${username} (${userId}) silindi`);
                alert(`KullanÄ±cÄ± "${username}" silindi (Mock iÅŸlem)`);
                await loadUsers(); // Listeyi yenile
                await loadUsers(); // Listeyi yenile
            } catch (error) {
                console.error('Mock silme iÅŸlemi hatasÄ±:', error);
                alert('Hata: ' + error.message);
            }
        }

        // KullanÄ±cÄ± detaylarÄ±nÄ± gÃ¶rÃ¼ntÃ¼le
        async function viewUserDetails(userId) {
            try {
                // allUsers array'inden kullanÄ±cÄ±yÄ± bul
                const user = allUsers.find(u => u._id === userId);
                
                if (!user) {
                    throw new Error('KullanÄ±cÄ± bulunamadÄ±');
                }
                
                const modalContent = document.getElementById('user-detail-content');
                    
                    modalContent.innerHTML = `
                        <div style="margin-bottom: 20px;">
                            <h4>ğŸ‘¤ ${user.username}</h4>
                            <p><strong>ğŸ“§ E-posta:</strong> ${user.email}</p>
                            <p><strong>ğŸ“… KayÄ±t Tarihi:</strong> ${new Date(user.createdAt).toLocaleString('tr-TR')}</p>
                            <p><strong>ğŸ”„ Son GÃ¼ncelleme:</strong> ${new Date(user.updatedAt).toLocaleString('tr-TR')}</p>
                            <p><strong>ğŸ• Son GiriÅŸ:</strong> ${user.lastLoginAt ? new Date(user.lastLoginAt).toLocaleString('tr-TR') : 'Bilinmiyor'}</p>
                            <p><strong>â­ Admin:</strong> ${user.isAdmin ? 'âœ… Evet' : 'âŒ HayÄ±r'}</p>
                            <p><strong>ï¿½ï¸ ModeratÃ¶r:</strong> ${user.isModerator ? 'âœ… Evet' : 'âŒ HayÄ±r'}</p>
                            ${user.isModerator && user.moderatorSeries ? `<p><strong>ğŸ“š AtanmÄ±ÅŸ Seriler:</strong> ${user.moderatorSeries.length} seri</p>` : ''}
                            <p><strong>ï¿½ğŸš« Engelli:</strong> ${user.isBlocked ? 'âœ… Evet' : 'âŒ HayÄ±r'}</p>
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <h5>ğŸ“Š KullanÄ±cÄ± Aktivitesi</h5>
                            <p><strong>â­ Verilen Puanlar:</strong> ${user.ratings ? user.ratings.length : 0}</p>
                            <p><strong>â¤ï¸ Favoriler:</strong> ${user.favorites ? user.favorites.length : 0}</p>
                            <p><strong>ğŸ“– Okunan Seriler:</strong> ${user.readSeries ? user.readSeries.length : 0}</p>
                            <p><strong>ğŸ“ˆ Okuma Ä°lerlemesi:</strong> ${user.readingProgress ? user.readingProgress.length : 0} seri</p>
                        </div>
                        
                        ${user.favorites && user.favorites.length > 0 ? `
                            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                                <h5>â¤ï¸ Favori Seriler</h5>
                                <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px;">
                                    ${user.favorites.map(fav => `<span style="background: #667eea; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px;">${fav}</span>`).join('')}
                                </div>
                            </div>
                        ` : ''}
                    `;
                    
                    // ModeratÃ¶r yÃ¶netimi bÃ¶lÃ¼mÃ¼nÃ¼ gÃ¶ster (admin olmayan kullanÄ±cÄ±lar iÃ§in)
                    const moderatorSection = document.getElementById('moderator-assignment-section');
                    if (!user.isAdmin) {
                        moderatorSection.style.display = 'block';
                        // Ã–nce serileri yÃ¼kle, sonra moderatÃ¶r atamasÄ±nÄ± ayarla
                        await loadSeriesForUserModeratorAssignment();
                        setupModeratorAssignment(user);
                    } else {
                        moderatorSection.style.display = 'none';
                    }
                    
                    document.getElementById('user-detail-modal').style.display = 'block';
            } catch (error) {
                alert('KullanÄ±cÄ± detaylarÄ± yÃ¼klenemedi: ' + error.message);
            }
        }

        // Modal kapatma
        function closeUserModal() {
            document.getElementById('user-detail-modal').style.display = 'none';
        }

        // Tab deÄŸiÅŸtiÄŸinde kullanÄ±cÄ±larÄ± yÃ¼kle
        const originalSwitchTab = switchTab;
        switchTab = function(tabName) {
            originalSwitchTab(tabName);
            if (tabName === 'users') {
                loadUsers();
                loadSeriesForUserModeratorAssignment();
            }
            if (tabName === 'moderators') {
                loadModerators();
                loadSeriesForModeratorAssignment();
            }
        };

        // Sayfa yÃ¼klendiÄŸinde giriÅŸ kontrolÃ¼
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Admin panel loading...');
            
            // URL parametresi ile localStorage temizleme
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('clear') === 'true') {
                localStorage.clear();
                console.log('localStorage cleared');
            }
            
            // Debug: localStorage durumunu kontrol et
            const currentToken = localStorage.getItem('token');
            console.log('Current token:', currentToken);
            
            // EÄŸer token yoksa veya geÃ§ersizse giriÅŸ formu gÃ¶ster
            if (!currentToken) {
                console.log('No token found, showing login form');
                document.querySelector('.admin-container').style.display = 'none';
                showLoginForm();
            } else {
                console.log('Token found, verifying...');
                // Token'Ä± verify et
                verifyToken(currentToken);
            }

            // Etiket ayarlarÄ± event listener'larÄ±
            const labelTextSelect = document.getElementById('edit-series-label-text');
            const labelColorSelect = document.getElementById('edit-series-label-color');
            
            if (labelTextSelect) {
                labelTextSelect.addEventListener('change', updateLabelPreview);
            }
            if (labelColorSelect) {
                labelColorSelect.addEventListener('change', updateLabelPreview);
            }
        });
        
        // Token doÄŸrulama fonksiyonu
        async function verifyToken(token) {
            try {
                const response = await fetch('https://toonnekoauth-api.onrender.com/api/admin/test-users', {
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    console.log('Token valid, showing admin panel');
                    document.querySelector('.admin-container').style.display = 'block';
                } else {
                    console.log('Token invalid, clearing and showing login');
                    localStorage.removeItem('token');
                    document.querySelector('.admin-container').style.display = 'none';
                    showLoginForm();
                }
            } catch (error) {
                console.log('Token verification failed:', error);
                localStorage.removeItem('token');
                document.querySelector('.admin-container').style.display = 'none';
                showLoginForm();
            }
        }

        // Yorum YÃ¶netimi FonksiyonlarÄ±
        let currentReportsPage = 1;
        let currentCommentsPage = 1;

        // Rapor istatistiklerini yÃ¼kle
        async function loadReportsStats() {
            try {
                const response = await fetch(`${API_BASE}/reports/admin/stats`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                
                if (response.ok) {
                    const stats = await response.json();
                    document.getElementById('pending-reports').textContent = stats.pendingReports;
                    document.getElementById('total-reports').textContent = stats.totalReports;
                    document.getElementById('reported-comments').textContent = stats.reportedComments;
                }
            } catch (error) {
                console.error('Stats yÃ¼klenirken hata:', error);
            }
        }

        // RaporlarÄ± yÃ¼kle
        async function loadReports(page = 1) {
            try {
                const status = document.getElementById('report-status-filter').value;
                const seriesId = document.getElementById('series-filter').value;
                
                const params = new URLSearchParams({
                    page,
                    status,
                    limit: 10
                });
                
                if (seriesId) params.append('seriesId', seriesId);
                
                const response = await fetch(`${API_BASE}/reports/admin/reports?${params}`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    renderReports(data.reports);
                    renderReportsPagination(data.page, data.totalPages);
                    currentReportsPage = data.page;
                }
            } catch (error) {
                console.error('Raporlar yÃ¼klenirken hata:', error);
            }
        }

        // RaporlarÄ± render et
        function renderReports(reports) {
            const listDiv = document.getElementById('reports-list');
            
            if (reports.length === 0) {
                listDiv.innerHTML = '<p style="text-align: center; color: #666;">Rapor bulunamadÄ±.</p>';
                return;
            }

            listDiv.innerHTML = reports.map(report => `
                <div class="report-item" style="border: 1px solid #ddd; border-radius: 8px; padding: 20px; margin-bottom: 15px; background: white;">
                    <div style="display: flex; justify-content: between; align-items: start; margin-bottom: 15px;">
                        <div style="flex: 1;">
                            <h4 style="margin: 0 0 8px 0; color: #333;">
                                ${report.seriesTitle} - ${report.replyId ? 'YanÄ±t' : 'Yorum'}
                                <span class="report-status status-${report.status}" style="
                                    padding: 4px 8px; 
                                    border-radius: 4px; 
                                    font-size: 0.8rem; 
                                    margin-left: 10px;
                                    background: ${getStatusColor(report.status)};
                                    color: white;
                                ">${getStatusText(report.status)}</span>
                            </h4>
                            <p style="margin: 5px 0; color: #666; font-size: 0.9rem;">
                                <strong>Rapor Eden:</strong> ${report.reportedBy} | 
                                <strong>Neden:</strong> ${getReasonText(report.reason)} | 
                                <strong>Tarih:</strong> ${new Date(report.reportDate).toLocaleString('tr-TR')}
                            </p>
                            ${report.description ? `<p style="margin: 5px 0; color: #666;"><strong>AÃ§Ä±klama:</strong> ${report.description}</p>` : ''}
                        </div>
                    </div>
                    
                    ${report.commentId ? `
                        <div style="background: #f9f9f9; padding: 15px; border-radius: 6px; margin: 15px 0;">
                            <p style="margin: 0; font-size: 0.9rem;"><strong>Yorum Ä°Ã§eriÄŸi:</strong></p>
                            <p style="margin: 5px 0 0 0; font-style: italic;">${report.commentId.text || 'Yorum iÃ§eriÄŸi yÃ¼klenemedi'}</p>
                            <p style="margin: 5px 0 0 0; font-size: 0.8rem; color: #666;">
                                <strong>Yazan:</strong> ${report.commentId.author || 'Bilinmiyor'}
                            </p>
                        </div>
                    ` : ''}
                    
                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        ${report.status === 'pending' ? `
                            <button onclick="updateReportStatus('${report._id}', 'reviewed', 'none')" 
                                style="background: #4CAF50; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer;">
                                âœ… Ä°ncelendi
                            </button>
                            <button onclick="deleteCommentFromReport('${report.commentId._id}', '${report.replyId || ''}', '${report._id}')" 
                                style="background: #f44336; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer;">
                                ğŸ—‘ï¸ Yorumu Sil
                            </button>
                            <button onclick="updateReportStatus('${report._id}', 'dismissed', 'none')" 
                                style="background: #9E9E9E; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer;">
                                âŒ Reddet
                            </button>
                        ` : `
                            <span style="color: #666; font-size: 0.9rem;">
                                ${report.reviewedBy ? `${report.reviewedBy} tarafÄ±ndan ${new Date(report.reviewedAt).toLocaleString('tr-TR')} tarihinde iÅŸlendi` : 'Ä°ÅŸlendi'}
                            </span>
                        `}
                    </div>
                </div>
            `).join('');
        }

        // Rapor durumunu gÃ¼ncelle
        async function updateReportStatus(reportId, status, action) {
            try {
                const response = await fetch(`${API_BASE}/reports/admin/reports/${reportId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: JSON.stringify({ status, action })
                });
                
                if (response.ok) {
                    showStatus('Rapor durumu gÃ¼ncellendi', 'success');
                    loadReports(currentReportsPage);
                    loadReportsStats();
                } else {
                    showStatus('Rapor gÃ¼ncellenirken hata oluÅŸtu', 'error');
                }
            } catch (error) {
                console.error('Rapor gÃ¼ncelleme hatasÄ±:', error);
                showStatus('Rapor gÃ¼ncellenirken hata oluÅŸtu', 'error');
            }
        }

        // Yorumu rapordan sil
        async function deleteCommentFromReport(commentId, replyId, reportId) {
            if (!confirm('Bu yorumu/yanÄ±tÄ± silmek istediÄŸinizden emin misiniz?')) return;
            
            try {
                const url = `${API_BASE}/reports/admin/comment/${commentId}${replyId ? `?replyId=${replyId}` : ''}`;
                const response = await fetch(url, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                
                if (response.ok) {
                    // Raporu da Ã§Ã¶zÃ¼mlendi olarak iÅŸaretle
                    await updateReportStatus(reportId, 'resolved', 'comment_deleted');
                    showStatus('Yorum silindi ve rapor Ã§Ã¶zÃ¼mlendi', 'success');
                } else {
                    showStatus('Yorum silinirken hata oluÅŸtu', 'error');
                }
            } catch (error) {
                console.error('Yorum silme hatasÄ±:', error);
                showStatus('Yorum silinirken hata oluÅŸtu', 'error');
            }
        }

        // Yorum yÃ¶netimi iÃ§in seri listesini yÃ¼kle
        async function loadCommentsSeriesList() {
            try {
                const response = await fetch(`${API_BASE}/admin/series-list`);
                const series = await response.json();
                
                const seriesFilter = document.getElementById('series-filter');
                const commentSeriesSelect = document.getElementById('comment-series-select');
                
                // Filtre iÃ§in
                seriesFilter.innerHTML = '<option value="">TÃ¼m Seriler</option>';
                series.forEach(s => {
                    const option = document.createElement('option');
                    option.value = s.seriesId;
                    option.textContent = `${s.title} (${s.chapterCount} bÃ¶lÃ¼m)`;
                    seriesFilter.appendChild(option);
                });
                
                // Yorum yÃ¶netimi iÃ§in
                commentSeriesSelect.innerHTML = '<option value="">-- Seri SeÃ§in --</option>';
                series.forEach(s => {
                    const option = document.createElement('option');
                    option.value = s.seriesId;
                    option.textContent = `${s.title} (${s.chapterCount} bÃ¶lÃ¼m)`;
                    commentSeriesSelect.appendChild(option);
                });
                
            } catch (error) {
                console.error('Seri listesi yÃ¼klenirken hata:', error);
            }
        }

        // Seri bazÄ±nda yorumlarÄ± yÃ¼kle
        async function loadSeriesComments(page = 1) {
            const seriesId = document.getElementById('comment-series-select').value;
            if (!seriesId) {
                document.getElementById('series-comments').style.display = 'none';
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/reports/admin/comments/${seriesId}?page=${page}&limit=10`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    renderSeriesComments(data.comments);
                    renderSeriesCommentsPagination(data.page, data.totalPages);
                    document.getElementById('series-comments').style.display = 'block';
                }
            } catch (error) {
                console.error('Seri yorumlarÄ± yÃ¼klenirken hata:', error);
            }
        }

        // Seri yorumlarÄ±nÄ± render et
        function renderSeriesComments(comments) {
            const listDiv = document.getElementById('series-comments-list');
            
            if (comments.length === 0) {
                listDiv.innerHTML = '<p style="text-align: center; color: #666;">Bu seride yorum bulunamadÄ±.</p>';
                return;
            }

            listDiv.innerHTML = comments.map(comment => {
                // Yorum konumunu belirle
                let location = 'Ana Seri SayfasÄ±';
                if (comment.chapterNumber) {
                    location = `BÃ¶lÃ¼m ${comment.chapterNumber}`;
                } else if (comment.seriesId && comment.seriesId.includes('-chapter-')) {
                    // Eski sistemde seriesId'den bÃ¶lÃ¼m numarasÄ±nÄ± Ã§Ä±kar
                    const chapterMatch = comment.seriesId.match(/-chapter-(\d+)$/);
                    if (chapterMatch) {
                        location = `BÃ¶lÃ¼m ${chapterMatch[1]}`;
                    }
                }
                
                return `
                <div class="comment-item" style="border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin-bottom: 10px; background: white;">
                    <div style="display: flex; justify-content: between; align-items: start;">
                        <div style="flex: 1;">
                            <p style="margin: 0 0 8px 0;">
                                <strong>${comment.author}</strong> - 
                                <span style="color: #666; font-size: 0.9rem;">${new Date(comment.date).toLocaleString('tr-TR')}</span>
                                <span style="background: #2196F3; color: white; padding: 2px 6px; border-radius: 3px; font-size: 0.8rem; margin-left: 10px;">${location}</span>
                                ${comment.deleted ? '<span style="color: red; font-size: 0.8rem; margin-left: 10px;">[SÄ°LÄ°NDÄ°]</span>' : ''}
                                ${comment.reported ? '<span style="background: #ff4444; color: white; padding: 2px 6px; border-radius: 3px; font-size: 0.8rem; margin-left: 10px;">RAPORLANDI</span>' : ''}
                            </p>
                            <p style="margin: 0; font-style: italic;">${comment.text}</p>
                            <p style="margin: 8px 0 0 0; font-size: 0.8rem; color: #666;">
                                ğŸ‘ ${comment.likes} | ğŸ‘ ${comment.dislikes} | ğŸ’¬ ${comment.replies ? comment.replies.length : 0} yanÄ±t
                            </p>
                        </div>
                        <div style="margin-left: 15px;">
                            ${!comment.deleted ? `
                                <button onclick="deleteComment('${comment._id}')" 
                                    style="background: #f44336; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">
                                    ğŸ—‘ï¸ Sil
                                </button>
                            ` : ''}
                        </div>
                    </div>
                    
                    ${comment.replies && comment.replies.length > 0 ? `
                        <div style="margin-top: 15px; padding-left: 20px; border-left: 3px solid #eee;">
                            <h5 style="margin: 0 0 10px 0; color: #666;">YanÄ±tlar:</h5>
                            ${comment.replies.map(reply => `
                                <div style="background: #f9f9f9; padding: 10px; border-radius: 4px; margin-bottom: 8px;">
                                    <p style="margin: 0 0 5px 0; font-size: 0.9rem;">
                                        <strong>${reply.author}</strong> - 
                                        <span style="color: #666; font-size: 0.8rem;">${new Date(reply.date).toLocaleString('tr-TR')}</span>
                                        ${reply.deleted ? '<span style="color: red; font-size: 0.8rem; margin-left: 10px;">[SÄ°LÄ°NDÄ°]</span>' : ''}
                                    </p>
                                    <p style="margin: 0; font-size: 0.9rem; font-style: italic;">${reply.text}</p>
                                    ${!reply.deleted ? `
                                        <button onclick="deleteReply('${comment._id}', '${reply._id}')" 
                                            style="background: #f44336; color: white; border: none; padding: 3px 8px; border-radius: 3px; cursor: pointer; font-size: 0.7rem; margin-top: 5px;">
                                            ğŸ—‘ï¸ Sil
                                        </button>
                                    ` : ''}
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                </div>
            `;
            }).join('');
        }

        // Yorum sil
        async function deleteComment(commentId) {
            if (!confirm('Bu yorumu silmek istediÄŸinizden emin misiniz?')) return;
            
            try {
                const response = await fetch(`${API_BASE}/reports/admin/comment/${commentId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                
                if (response.ok) {
                    showStatus('Yorum silindi', 'success');
                    loadSeriesComments(currentCommentsPage);
                } else {
                    showStatus('Yorum silinirken hata oluÅŸtu', 'error');
                }
            } catch (error) {
                console.error('Yorum silme hatasÄ±:', error);
                showStatus('Yorum silinirken hata oluÅŸtu', 'error');
            }
        }

        // YanÄ±t sil
        async function deleteReply(commentId, replyId) {
            if (!confirm('Bu yanÄ±tÄ± silmek istediÄŸinizden emin misiniz?')) return;
            
            try {
                const response = await fetch(`${API_BASE}/reports/admin/comment/${commentId}?replyId=${replyId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                
                if (response.ok) {
                    showStatus('YanÄ±t silindi', 'success');
                    loadSeriesComments(currentCommentsPage);
                } else {
                    showStatus('YanÄ±t silinirken hata oluÅŸtu', 'error');
                }
            } catch (error) {
                console.error('YanÄ±t silme hatasÄ±:', error);
                showStatus('YanÄ±t silinirken hata oluÅŸtu', 'error');
            }
        }

        // Pagination render fonksiyonlarÄ±
        function renderReportsPagination(currentPage, totalPages) {
            const paginationDiv = document.getElementById('reports-pagination');
            if (totalPages <= 1) {
                paginationDiv.innerHTML = '';
                return;
            }
            
            let html = '';
            for (let i = 1; i <= totalPages; i++) {
                html += `<button onclick="loadReports(${i})" 
                    style="margin: 0 2px; padding: 5px 10px; border: 1px solid #ddd; background: ${i === currentPage ? '#667eea' : 'white'}; color: ${i === currentPage ? 'white' : 'black'}; cursor: pointer; border-radius: 3px;">
                    ${i}
                </button>`;
            }
            paginationDiv.innerHTML = html;
        }

        function renderSeriesCommentsPagination(currentPage, totalPages) {
            const paginationDiv = document.getElementById('series-comments-pagination');
            if (totalPages <= 1) {
                paginationDiv.innerHTML = '';
                return;
            }
            
            let html = '';
            for (let i = 1; i <= totalPages; i++) {
                html += `<button onclick="loadSeriesComments(${i})" 
                    style="margin: 0 2px; padding: 5px 10px; border: 1px solid #ddd; background: ${i === currentPage ? '#667eea' : 'white'}; color: ${i === currentPage ? 'white' : 'black'}; cursor: pointer; border-radius: 3px;">
                    ${i}
                </button>`;
            }
            paginationDiv.innerHTML = html;
        }

        // YardÄ±mcÄ± fonksiyonlar
        function getStatusColor(status) {
            const colors = {
                'pending': '#ff4444',
                'reviewed': '#4CAF50',
                'resolved': '#2196F3',
                'dismissed': '#9E9E9E'
            };
            return colors[status] || '#666';
        }

        function getStatusText(status) {
            const texts = {
                'pending': 'Bekliyor',
                'reviewed': 'Ä°ncelendi',
                'resolved': 'Ã‡Ã¶zÃ¼ldÃ¼',
                'dismissed': 'Reddedildi'
            };
            return texts[status] || status;
        }

        function getReasonText(reason) {
            const reasons = {
                'spam': 'Spam/Reklam',
                'harassment': 'Taciz/ZorbalÄ±k',
                'hate-speech': 'Nefret SÃ¶ylemi',
                'inappropriate': 'Uygunsuz Ä°Ã§erik',
                'misinformation': 'YanlÄ±ÅŸ Bilgi',
                'other': 'DiÄŸer'
            };
            return reasons[reason] || reason;
        }

        // Duyuru YÃ¶netimi FonksiyonlarÄ±
        let announcementCurrentPage = 1;
        let announcementTotalPages = 1;
        const announcementItemsPerPage = 10;

        // Duyuru formu submit event listener
        document.getElementById('announcement-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            await createAnnouncement();
        });

        // Duyuru filtreleme
        document.getElementById('announcement-filter').addEventListener('change', function() {
            announcementCurrentPage = 1;
            loadAnnouncements();
        });

        // Duyuru listesi yenileme
        document.getElementById('refresh-announcements').addEventListener('click', function() {
            loadAnnouncements();
        });

        // Duyuru formu temizleme
        document.getElementById('clear-announcement-form').addEventListener('click', function() {
            clearAnnouncementForm();
        });

        async function createAnnouncement() {
            const form = document.getElementById('announcement-form');
            const formData = new FormData(form);
            
            const announcementData = {
                title: formData.get('title'),
                content: formData.get('content'),
                type: formData.get('type'),
                isActive: formData.has('isActive')
            };

            try {
                showStatus('Duyuru ekleniyor...', 'info');
                
                const response = await fetch('https://toonnekoauth-api.onrender.com/api/announcements', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + localStorage.getItem('token')
                    },
                    body: JSON.stringify(announcementData)
                });

                const result = await response.json();

                if (response.ok && result.success) {
                    showStatus('âœ… Duyuru baÅŸarÄ±yla eklendi!', 'success');
                    clearAnnouncementForm();
                    loadAnnouncements();
                } else {
                    showStatus('âŒ ' + (result.message || 'Duyuru eklenirken hata oluÅŸtu'), 'error');
                }
            } catch (error) {
                console.error('Duyuru ekleme hatasÄ±:', error);
                showStatus('âŒ Duyuru eklenirken hata oluÅŸtu', 'error');
            }
        }

        async function loadAnnouncements() {
            try {
                const filter = document.getElementById('announcement-filter').value;
                const response = await fetch(`https://toonnekoauth-api.onrender.com/api/announcements?page=${announcementCurrentPage}&limit=${announcementItemsPerPage}&filter=${filter}`, {
                    headers: {
                        'Authorization': 'Bearer ' + localStorage.getItem('token')
                    }
                });

                const result = await response.json();

                if (response.ok && result.success) {
                    displayAnnouncements(result.announcements);
                    updateAnnouncementPagination(result.pagination);
                } else {
                    showStatus('âŒ Duyurular yÃ¼klenirken hata oluÅŸtu', 'error');
                }
            } catch (error) {
                console.error('Duyuru yÃ¼kleme hatasÄ±:', error);
                showStatus('âŒ Duyurular yÃ¼klenirken hata oluÅŸtu', 'error');
            }
        }

        function displayAnnouncements(announcements) {
            const container = document.getElementById('announcements-list');
            
            if (!announcements || announcements.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 40px; color: #888;">HenÃ¼z duyuru bulunmuyor.</div>';
                return;
            }

            container.innerHTML = announcements.map(announcement => `
                <div class="announcement-item">
                    <div class="announcement-header-item">
                        <h4 class="announcement-title-item">${escapeHtml(announcement.title)}</h4>
                        <div>
                            <span class="announcement-type-badge announcement-type-${announcement.type}">
                                ${getTypeLabel(announcement.type)}
                            </span>
                            <span class="announcement-status-badge ${announcement.isActive ? 'announcement-active' : 'announcement-inactive'}">
                                ${announcement.isActive ? 'Aktif' : 'Pasif'}
                            </span>
                        </div>
                    </div>
                    <div class="announcement-content-item">${escapeHtml(announcement.content)}</div>
                    <div class="announcement-meta">
                        <span class="announcement-date">${formatDate(announcement.createdAt)}</span>
                        <div class="announcement-actions">
                            <button class="btn-edit-announcement" onclick="editAnnouncement('${announcement._id}')">
                                âœï¸ DÃ¼zenle
                            </button>
                            <button class="btn-toggle-announcement" onclick="toggleAnnouncement('${announcement._id}', ${!announcement.isActive})">
                                ${announcement.isActive ? 'ğŸ”´ PasifleÅŸtir' : 'ğŸŸ¢ AktifleÅŸtir'}
                            </button>
                            <button class="btn-delete-announcement" onclick="deleteAnnouncement('${announcement._id}')">
                                ğŸ—‘ï¸ Sil
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function updateAnnouncementPagination(pagination) {
            announcementTotalPages = pagination.totalPages;
            announcementCurrentPage = pagination.currentPage;

            const container = document.getElementById('announcements-pagination');
            
            if (announcementTotalPages <= 1) {
                container.innerHTML = '';
                return;
            }

            let paginationHTML = '';
            
            // Previous button
            paginationHTML += `
                <button class="pagination-btn" onclick="changeAnnouncementPage(${announcementCurrentPage - 1})" 
                        ${announcementCurrentPage <= 1 ? 'disabled' : ''}>
                    â† Ã–nceki
                </button>
            `;

            // Page numbers
            for (let i = 1; i <= announcementTotalPages; i++) {
                if (i === 1 || i === announcementTotalPages || (i >= announcementCurrentPage - 2 && i <= announcementCurrentPage + 2)) {
                    paginationHTML += `
                        <button class="pagination-btn ${i === announcementCurrentPage ? 'active' : ''}" 
                                onclick="changeAnnouncementPage(${i})">
                            ${i}
                        </button>
                    `;
                } else if (i === announcementCurrentPage - 3 || i === announcementCurrentPage + 3) {
                    paginationHTML += '<span class="pagination-ellipsis">...</span>';
                }
            }

            // Next button
            paginationHTML += `
                <button class="pagination-btn" onclick="changeAnnouncementPage(${announcementCurrentPage + 1})" 
                        ${announcementCurrentPage >= announcementTotalPages ? 'disabled' : ''}>
                    Sonraki â†’
                </button>
            `;

            container.innerHTML = paginationHTML;
        }

        function changeAnnouncementPage(page) {
            if (page >= 1 && page <= announcementTotalPages) {
                announcementCurrentPage = page;
                loadAnnouncements();
            }
        }

        async function toggleAnnouncement(announcementId, isActive) {
            try {
                const response = await fetch(`https://toonnekoauth-api.onrender.com/api/announcements/${announcementId}/toggle`, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': 'Bearer ' + localStorage.getItem('token')
                    }
                });

                const result = await response.json();

                if (response.ok && result.success) {
                    showStatus(`âœ… Duyuru ${isActive ? 'aktifleÅŸtirildi' : 'pasifleÅŸtirildi'}!`, 'success');
                    loadAnnouncements();
                } else {
                    showStatus('âŒ ' + (result.message || 'Duyuru gÃ¼ncellenirken hata oluÅŸtu'), 'error');
                }
            } catch (error) {
                console.error('Duyuru gÃ¼ncelleme hatasÄ±:', error);
                showStatus('âŒ Duyuru gÃ¼ncellenirken hata oluÅŸtu', 'error');
            }
        }

        async function deleteAnnouncement(announcementId) {
            if (!confirm('Bu duyuruyu silmek istediÄŸinizden emin misiniz?')) {
                return;
            }

            try {
                const response = await fetch(`https://toonnekoauth-api.onrender.com/api/announcements/${announcementId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': 'Bearer ' + localStorage.getItem('token')
                    }
                });

                const result = await response.json();

                if (response.ok && result.success) {
                    showStatus('âœ… Duyuru baÅŸarÄ±yla silindi!', 'success');
                    loadAnnouncements();
                } else {
                    showStatus('âŒ ' + (result.message || 'Duyuru silinirken hata oluÅŸtu'), 'error');
                }
            } catch (error) {
                console.error('Duyuru silme hatasÄ±:', error);
                showStatus('âŒ Duyuru silinirken hata oluÅŸtu', 'error');
            }
        }

        async function editAnnouncement(announcementId) {
            try {
                const response = await fetch(`https://toonnekoauth-api.onrender.com/api/announcements/${announcementId}`, {
                    headers: {
                        'Authorization': 'Bearer ' + localStorage.getItem('token')
                    }
                });

                const result = await response.json();

                if (response.ok && result.success) {
                    // Form alanlarÄ±nÄ± doldur
                    document.getElementById('announcement-title').value = result.announcement.title;
                    document.getElementById('announcement-content').value = result.announcement.content;
                    document.getElementById('announcement-type').value = result.announcement.type;
                    document.getElementById('announcement-active').checked = result.announcement.isActive;

                    // Form submit handler'Ä±nÄ± gÃ¼ncelleme moduna Ã§evir
                    const form = document.getElementById('announcement-form');
                    form.onsubmit = async function(e) {
                        e.preventDefault();
                        await updateAnnouncement(announcementId);
                    };

                    // Form butonunu gÃ¼ncelle
                    const submitBtn = form.querySelector('button[type="submit"]');
                    submitBtn.textContent = 'âœï¸ Duyuru GÃ¼ncelle';
                    submitBtn.style.background = '#ff9800';

                    // SayfayÄ± yukarÄ± kaydÄ±r
                    form.scrollIntoView({ behavior: 'smooth' });
                } else {
                    showStatus('âŒ Duyuru bilgileri yÃ¼klenirken hata oluÅŸtu', 'error');
                }
            } catch (error) {
                console.error('Duyuru yÃ¼kleme hatasÄ±:', error);
                showStatus('âŒ Duyuru bilgileri yÃ¼klenirken hata oluÅŸtu', 'error');
            }
        }

        async function updateAnnouncement(announcementId) {
            const form = document.getElementById('announcement-form');
            const formData = new FormData(form);
            
            const announcementData = {
                title: formData.get('title'),
                content: formData.get('content'),
                type: formData.get('type'),
                isActive: formData.has('isActive')
            };

            try {
                showStatus('Duyuru gÃ¼ncelleniyor...', 'info');
                
                const response = await fetch(`https://toonnekoauth-api.onrender.com/api/announcements/${announcementId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + localStorage.getItem('token')
                    },
                    body: JSON.stringify(announcementData)
                });

                const result = await response.json();

                if (response.ok && result.success) {
                    showStatus('âœ… Duyuru baÅŸarÄ±yla gÃ¼ncellendi!', 'success');
                    clearAnnouncementForm();
                    loadAnnouncements();
                } else {
                    showStatus('âŒ ' + (result.message || 'Duyuru gÃ¼ncellenirken hata oluÅŸtu'), 'error');
                }
            } catch (error) {
                console.error('Duyuru gÃ¼ncelleme hatasÄ±:', error);
                showStatus('âŒ Duyuru gÃ¼ncellenirken hata oluÅŸtu', 'error');
            }
        }

        function clearAnnouncementForm() {
            const form = document.getElementById('announcement-form');
            form.reset();
            
            // Form submit handler'Ä±nÄ± yeni duyuru moduna Ã§evir
            form.onsubmit = async function(e) {
                e.preventDefault();
                await createAnnouncement();
            };

            // Form butonunu sÄ±fÄ±rla
            const submitBtn = form.querySelector('button[type="submit"]');
            submitBtn.textContent = 'ğŸ“¢ Duyuru Ekle';
            submitBtn.style.background = '#667eea';
        }

        function getTypeLabel(type) {
            switch (type) {
                case 'info': return 'â„¹ï¸ Bilgi';
                case 'warning': return 'âš ï¸ UyarÄ±';
                case 'success': return 'âœ… BaÅŸarÄ±';
                default: return 'â„¹ï¸ Bilgi';
            }
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('tr-TR', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // Ä°statistikler iÃ§in fonksiyonlar
        
        // Ana istatistikleri yÃ¼kle
        async function loadStatsOverview() {
            try {
                // Seri bazÄ±nda istatistikler
                const seriesResponse = await fetch(`${API_BASE}/stats/series-stats`);
                const seriesData = await seriesResponse.json();
                
                if (seriesData.success) {
                    const stats = seriesData.data;
                    
                    // Toplam okuma hesapla
                    const totalReads = stats.reduce((sum, series) => sum + series.totalReads, 0);
                    const weeklyReads = stats.reduce((sum, series) => sum + series.weeklyReads, 0);
                    const totalSeries = stats.length;
                    
                    // BugÃ¼nkÃ¼ okuma sayÄ±sÄ±nÄ± al (haftalÄ±k veriden tahmin et)
                    const todayReads = Math.round(weeklyReads / 7);
                    
                    // Ä°statistik kartlarÄ±nÄ± gÃ¼ncelle
                    document.getElementById('total-reads-today').textContent = formatNumber(todayReads);
                    document.getElementById('total-reads-week').textContent = formatNumber(weeklyReads);
                    document.getElementById('total-reads-all').textContent = formatNumber(totalReads);
                    document.getElementById('total-series-read').textContent = totalSeries;
                    
                    // En popÃ¼ler seriler tablosunu gÃ¼ncelle
                    updatePopularSeriesTable(stats);
                }
            } catch (error) {
                console.error('Stats overview error:', error);
                showStatus('Ä°statistik verileri yÃ¼klenirken hata oluÅŸtu', 'error');
            }
        }
        
        // DetaylÄ± istatistikleri yÃ¼kle
        async function loadDetailedStats(page = 1) {
            try {
                const seriesFilter = document.getElementById('stats-series-filter').value;
                const periodFilter = document.getElementById('stats-period-filter').value;
                
                let url = `${API_BASE}/stats/admin/detailed-stats?page=${page}&limit=20`;
                if (seriesFilter) {
                    url += `&seriesId=${encodeURIComponent(seriesFilter)}`;
                }
                
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.success) {
                    updateDetailedStatsTable(data.data);
                    updateStatsPagination(data.pagination);
                }
            } catch (error) {
                console.error('Detailed stats error:', error);
                showStatus('DetaylÄ± istatistikler yÃ¼klenirken hata oluÅŸtu', 'error');
            }
        }
        
        // Ä°statistikler iÃ§in seri listesini yÃ¼kle
        async function loadStatsSeriesList() {
            try {
                const response = await fetch(`${API_BASE}/stats/series-stats`);
                const data = await response.json();
                
                if (data.success) {
                    const select = document.getElementById('stats-series-filter');
                    select.innerHTML = '<option value="">TÃ¼m Seriler</option>';
                    
                    data.data.forEach(series => {
                        const option = document.createElement('option');
                        option.value = series._id;
                        option.textContent = `${series.seriesTitle} (${formatNumber(series.totalReads)} okuma)`;
                        select.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Stats series list error:', error);
            }
        }
        
        // En popÃ¼ler seriler tablosunu gÃ¼ncelle
        function updatePopularSeriesTable(seriesStats) {
            const tbody = document.getElementById('popular-series-table');
            
            if (!seriesStats || seriesStats.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="padding: 20px; text-align: center; color: #666;">HenÃ¼z okuma verisi yok</td></tr>';
                return;
            }
            
            const sortedSeries = seriesStats
                .sort((a, b) => b.totalReads - a.totalReads)
                .slice(0, 20);
            
            tbody.innerHTML = sortedSeries.map((series, index) => {
                const avgReads = Math.round(series.avgReadsPerChapter || 0);
                const lastRead = series.lastRead ? formatDate(series.lastRead) : 'HiÃ§ okunmadÄ±';
                
                return `
                    <tr style="border-bottom: 1px solid #dee2e6;">
                        <td style="padding: 12px; font-weight: bold; color: #666;">${index + 1}</td>
                        <td style="padding: 12px; font-weight: 500;">${escapeHtml(series.seriesTitle)}</td>
                        <td style="padding: 12px; text-align: center; font-weight: bold; color: #007bff;">${formatNumber(series.totalReads)}</td>
                        <td style="padding: 12px; text-align: center; color: #ff6f61;">${formatNumber(series.weeklyReads)}</td>
                        <td style="padding: 12px; text-align: center;">${series.chapterCount}</td>
                        <td style="padding: 12px; text-align: center; color: #28a745;">${formatNumber(avgReads)}</td>
                        <td style="padding: 12px; text-align: center; font-size: 0.9rem; color: #666;">${lastRead}</td>
                    </tr>
                `;
            }).join('');
        }
        
        // DetaylÄ± istatistikler tablosunu gÃ¼ncelle
        function updateDetailedStatsTable(statsData) {
            const tbody = document.getElementById('detailed-stats-table');
            
            if (!statsData || statsData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="padding: 20px; text-align: center; color: #666;">Veri bulunamadÄ±</td></tr>';
                return;
            }
            
            tbody.innerHTML = statsData.map(stat => {
                const lastRead = stat.lastRead ? formatDate(stat.lastRead) : 'HiÃ§ okunmadÄ±';
                
                return `
                    <tr style="border-bottom: 1px solid #dee2e6;">
                        <td style="padding: 12px; font-weight: 500;">${escapeHtml(stat.seriesTitle)}</td>
                        <td style="padding: 12px; text-align: center;">BÃ¶lÃ¼m ${stat.chapterNumber}</td>
                        <td style="padding: 12px; text-align: center; font-weight: bold; color: #007bff;">${formatNumber(stat.totalReads)}</td>
                        <td style="padding: 12px; text-align: center; color: #ff6f61;">${formatNumber(stat.weeklyReads)}</td>
                        <td style="padding: 12px; text-align: center; color: #ffc107;">${formatNumber(stat.dailyReads)}</td>
                        <td style="padding: 12px; text-align: center; font-size: 0.9rem; color: #666;">${lastRead}</td>
                    </tr>
                `;
            }).join('');
        }
        
        // Pagination gÃ¼ncelle
        function updateStatsPagination(pagination) {
            const container = document.getElementById('stats-pagination');
            
            if (!pagination || pagination.pages <= 1) {
                container.innerHTML = '';
                return;
            }
            
            const { page, pages } = pagination;
            let html = '<div style="display: flex; gap: 5px; justify-content: center; align-items: center;">';
            
            // Previous button
            if (page > 1) {
                html += `<button onclick="loadDetailedStats(${page - 1})" style="padding: 8px 12px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">â€¹ Ã–nceki</button>`;
            }
            
            // Page numbers
            const maxVisible = 5;
            let startPage = Math.max(1, page - Math.floor(maxVisible / 2));
            let endPage = Math.min(pages, startPage + maxVisible - 1);
            
            if (endPage - startPage + 1 < maxVisible) {
                startPage = Math.max(1, endPage - maxVisible + 1);
            }
            
            for (let i = startPage; i <= endPage; i++) {
                const isActive = i === page;
                html += `<button onclick="loadDetailedStats(${i})" style="padding: 8px 12px; background: ${isActive ? '#6c757d' : '#fff'}; color: ${isActive ? 'white' : '#007bff'}; border: 1px solid ${isActive ? '#6c757d' : '#007bff'}; border-radius: 4px; cursor: pointer;">${i}</button>`;
            }
            
            // Next button
            if (page < pages) {
                html += `<button onclick="loadDetailedStats(${page + 1})" style="padding: 8px 12px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">Sonraki â€º</button>`;
            }
            
            html += `<span style="margin-left: 15px; color: #666;">Sayfa ${page} / ${pages}</span>`;
            html += '</div>';
            
            container.innerHTML = html;
        }
        
        // SayÄ± formatlama
        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toString();
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Token alma fonksiyonu
        function getToken() {
            return localStorage.getItem('token') || 'test-admin-token-for-development';
        }

        // ========== MODERATÃ–R YÃ–NETÄ°MÄ° FONKSÄ°YONLARI ==========

        // ModeratÃ¶rleri yÃ¼kle
        async function loadModerators() {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_BASE}/admin/moderators`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) throw new Error('ModeratÃ¶rler yÃ¼klenemedi');

                const moderators = await response.json();
                displayModerators(moderators);
                updateModeratorStats(moderators);
            } catch (error) {
                console.error('ModeratÃ¶rleri yÃ¼kleme hatasÄ±:', error);
                showErrorAlert('ModeratÃ¶rleri yÃ¼klerken hata oluÅŸtu');
            }
        }

        // ModeratÃ¶rleri gÃ¶rÃ¼ntÃ¼le
        function displayModerators(moderators) {
            const container = document.getElementById('moderators-list');
            const loading = document.getElementById('moderators-loading');

            loading.style.display = 'none';
            container.style.display = 'block';

            if (moderators.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 40px; color: #666;">HenÃ¼z moderatÃ¶r atanmamÄ±ÅŸ</div>';
                return;
            }

            container.innerHTML = moderators.map(moderator => `
                <div class="moderator-card" style="background: white; border: 1px solid #e0e0e0; border-radius: 10px; padding: 20px; margin-bottom: 15px;">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                        <div style="flex: 1;">
                            <h4 style="margin-bottom: 8px; color: #333;">ğŸ›¡ï¸ ${escapeHtml(moderator.username)}</h4>
                            <p style="color: #666; margin-bottom: 8px;">${escapeHtml(moderator.email)}</p>
                            <div style="margin-bottom: 10px;">
                                <span style="background: #28a745; color: white; padding: 3px 8px; border-radius: 12px; font-size: 12px;">
                                    ModeratÃ¶r
                                </span>
                            </div>
                            <div>
                                <strong style="color: #667eea;">AtanmÄ±ÅŸ Seriler (${moderator.moderatorSeries.length}):</strong>
                                <div style="margin-top: 5px;">
                                    ${moderator.moderatorSeries.length > 0 
                                        ? moderator.moderatorSeries.map(seriesId => 
                                            `<span style="background: #f8f9fa; border: 1px solid #dee2e6; padding: 2px 6px; border-radius: 4px; margin-right: 5px; font-size: 12px;">${seriesId}</span>`
                                          ).join('') 
                                        : '<span style="color: #999; font-style: italic;">Seri atanmamÄ±ÅŸ</span>'
                                    }
                                </div>
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button onclick="editModerator('${moderator._id}')" style="background: #667eea; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; font-size: 12px;">
                                âœï¸ DÃ¼zenle
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // ModeratÃ¶r istatistiklerini gÃ¼ncelle
        function updateModeratorStats(moderators) {
            const totalModerators = moderators.length;
            const activeModerators = moderators.filter(m => m.moderatorSeries.length > 0).length;
            const totalManagedSeries = new Set(moderators.flatMap(m => m.moderatorSeries)).size;

            document.getElementById('total-moderators-count').textContent = totalModerators;
            document.getElementById('active-moderators-count').textContent = activeModerators;
            document.getElementById('managed-series-count').textContent = totalManagedSeries;
        }

        // ModeratÃ¶r atama iÃ§in serileri yÃ¼kle
        async function loadSeriesForModeratorAssignment() {
            try {
                // Test endpoint kullan (geÃ§ici Ã§Ã¶zÃ¼m)
                const response = await fetch(`${API_BASE}/admin/test-available-series`, {
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) throw new Error('Seriler yÃ¼klenemedi');

                const data = await response.json();
                console.log('ModeratÃ¶r atama iÃ§in gelen seri verisi:', data);
                
                let series = [];
                if (data.success && Array.isArray(data.series)) {
                    series = data.series;
                } else if (Array.isArray(data)) {
                    series = data;
                } else {
                    console.error('Beklenmeyen veri formatÄ±:', data);
                    throw new Error('Seri verisi yanlÄ±ÅŸ formatta');
                }
                
                const editSeriesSelect = document.getElementById('edit-series-select');
                
                const seriesOptions = series.map(s => 
                    `<option value="${s.id}">${escapeHtml(s.title)} ${s.status ? `(${s.status})` : ''}</option>`
                ).join('');
                
                editSeriesSelect.innerHTML = seriesOptions;
            } catch (error) {
                console.error('Serileri yÃ¼kleme hatasÄ±:', error);
            }
        }

        // ModeratÃ¶r dÃ¼zenle
        async function editModerator(moderatorId) {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_BASE}/admin/users`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) throw new Error('KullanÄ±cÄ± bilgileri alÄ±namadÄ±');

                const users = await response.json();
                const moderator = users.find(u => u._id === moderatorId);
                
                if (!moderator) {
                    showErrorAlert('ModeratÃ¶r bulunamadÄ±');
                    return;
                }

                // Modal iÃ§eriÄŸini doldur
                document.getElementById('edit-moderator-id').value = moderatorId;
                document.getElementById('edit-moderator-info').innerHTML = `
                    <div><strong>KullanÄ±cÄ± AdÄ±:</strong> ${escapeHtml(moderator.username)}</div>
                    <div><strong>E-posta:</strong> ${escapeHtml(moderator.email)}</div>
                    <div><strong>KayÄ±t Tarihi:</strong> ${new Date(moderator.createdAt).toLocaleDateString('tr-TR')}</div>
                `;

                // Mevcut serileri seÃ§ili yap
                const editSeriesSelect = document.getElementById('edit-series-select');
                Array.from(editSeriesSelect.options).forEach(option => {
                    option.selected = moderator.moderatorSeries.includes(option.value);
                });

                // ModalÄ± gÃ¶ster
                document.getElementById('moderator-edit-modal').style.display = 'block';
            } catch (error) {
                console.error('ModeratÃ¶r dÃ¼zenleme hatasÄ±:', error);
                showErrorAlert('ModeratÃ¶r bilgileri alÄ±namadÄ±');
            }
        }

        // ModeratÃ¶r modalÄ±nÄ± kapat
        function closeModeratorModal() {
            document.getElementById('moderator-edit-modal').style.display = 'none';
        }

        // ModeratÃ¶r gÃ¼ncelle
        document.getElementById('edit-moderator-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const moderatorId = document.getElementById('edit-moderator-id').value;
            const seriesSelect = document.getElementById('edit-series-select');
            const selectedSeries = Array.from(seriesSelect.selectedOptions).map(option => option.value);
            
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_BASE}/admin/update-moderator-series`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        userId: moderatorId,
                        seriesIds: selectedSeries
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'ModeratÃ¶r gÃ¼ncelleme baÅŸarÄ±sÄ±z');
                }

                showSuccessAlert('ModeratÃ¶r serileri baÅŸarÄ±yla gÃ¼ncellendi');
                closeModeratorModal();
                loadModerators();
            } catch (error) {
                console.error('ModeratÃ¶r gÃ¼ncelleme hatasÄ±:', error);
                showErrorAlert(error.message);
            }
        });

        // ModeratÃ¶r kaldÄ±r
        async function removeModerator() {
            const moderatorId = document.getElementById('edit-moderator-id').value;
            
            if (!confirm('Bu kullanÄ±cÄ±nÄ±n moderatÃ¶r yetkilerini kaldÄ±rmak istediÄŸinizden emin misiniz?')) {
                return;
            }
            
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_BASE}/admin/remove-moderator`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        userId: moderatorId
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'ModeratÃ¶r kaldÄ±rma baÅŸarÄ±sÄ±z');
                }

                showSuccessAlert('ModeratÃ¶r yetkileri baÅŸarÄ±yla kaldÄ±rÄ±ldÄ±');
                closeModeratorModal();
                loadModerators();
                loadUsersForModeratorAssignment();
            } catch (error) {
                console.error('ModeratÃ¶r kaldÄ±rma hatasÄ±:', error);
                showErrorAlert(error.message);
            }
        }

        // ========== KULLANICI YÃ–NETÄ°MÄ°NDE MODERATÃ–R FONKSÄ°YONLARI ==========

        // KullanÄ±cÄ± iÃ§in seri yÃ¼kleme
        async function loadSeriesForUserModeratorAssignment() {
            try {
                // Test endpoint kullan (geÃ§ici Ã§Ã¶zÃ¼m)
                const response = await fetch(`${API_BASE}/admin/test-available-series`, {
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) throw new Error('Seriler yÃ¼klenemedi');

                const data = await response.json();
                console.log('Gelen seri verisi:', data);
                
                let series = [];
                if (data.success && Array.isArray(data.series)) {
                    series = data.series;
                } else if (Array.isArray(data)) {
                    series = data;
                } else {
                    console.error('Beklenmeyen veri formatÄ±:', data);
                    throw new Error('Seri verisi yanlÄ±ÅŸ formatta');
                }
                
                const userSeriesSelect = document.getElementById('user-series-select');
                
                const seriesOptions = series.map(s => 
                    `<option value="${s.id}">${escapeHtml(s.title)} ${s.status ? `(${s.status})` : ''}</option>`
                ).join('');
                
                userSeriesSelect.innerHTML = seriesOptions;
            } catch (error) {
                console.error('Serileri yÃ¼kleme hatasÄ±:', error);
            }
        }

        // ModeratÃ¶r atama iÅŸlemini ayarla
        function setupModeratorAssignment(user) {
            document.getElementById('selected-user-id').value = user._id;
            
            // ButonlarÄ± kullanÄ±cÄ± durumuna gÃ¶re ayarla
            const makeModerator = document.getElementById('make-moderator-btn');
            const updateModerator = document.getElementById('update-moderator-btn');
            const removeModerator = document.getElementById('remove-moderator-btn');
            const seriesSelect = document.getElementById('user-series-select');
            
            if (user.isModerator) {
                // KullanÄ±cÄ± zaten moderatÃ¶r
                makeModerator.style.display = 'none';
                updateModerator.style.display = 'inline-block';
                removeModerator.style.display = 'inline-block';
                
                // Mevcut serileri seÃ§ili yap
                Array.from(seriesSelect.options).forEach(option => {
                    option.selected = user.moderatorSeries && user.moderatorSeries.includes(option.value);
                });
            } else {
                // KullanÄ±cÄ± henÃ¼z moderatÃ¶r deÄŸil
                makeModerator.style.display = 'inline-block';
                updateModerator.style.display = 'none';
                removeModerator.style.display = 'none';
                
                // TÃ¼m seÃ§imleri temizle
                Array.from(seriesSelect.options).forEach(option => {
                    option.selected = false;
                });
            }
        }

        // KullanÄ±cÄ±yÄ± moderatÃ¶r yap
        async function makeUserModerator() {
            const userId = document.getElementById('selected-user-id').value;
            const seriesSelect = document.getElementById('user-series-select');
            const selectedSeries = Array.from(seriesSelect.selectedOptions).map(option => option.value);
            
            if (!userId) {
                showErrorAlert('KullanÄ±cÄ± ID bulunamadÄ±');
                return;
            }
            
            try {
                const token = getToken();
                const response = await fetch(`${API_BASE}/admin/make-moderator`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        userId: userId,
                        seriesIds: selectedSeries
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'ModeratÃ¶r atama baÅŸarÄ±sÄ±z');
                }

                showSuccessAlert('KullanÄ±cÄ± baÅŸarÄ±yla moderatÃ¶r yapÄ±ldÄ±');
                closeUserModal();
                loadUsers(); // KullanÄ±cÄ± listesini yenile
            } catch (error) {
                console.error('ModeratÃ¶r atama hatasÄ±:', error);
                showErrorAlert(error.message);
            }
        }

        // KullanÄ±cÄ±nÄ±n moderatÃ¶r serilerini gÃ¼ncelle
        async function updateUserModeratorSeries() {
            const userId = document.getElementById('selected-user-id').value;
            const seriesSelect = document.getElementById('user-series-select');
            const selectedSeries = Array.from(seriesSelect.selectedOptions).map(option => option.value);
            
            if (!userId) {
                showErrorAlert('KullanÄ±cÄ± ID bulunamadÄ±');
                return;
            }
            
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_BASE}/admin/update-moderator-series`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        userId: userId,
                        seriesIds: selectedSeries
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'ModeratÃ¶r gÃ¼ncelleme baÅŸarÄ±sÄ±z');
                }

                showSuccessAlert('ModeratÃ¶r serileri baÅŸarÄ±yla gÃ¼ncellendi');
                closeUserModal();
                loadUsers(); // KullanÄ±cÄ± listesini yenile
            } catch (error) {
                console.error('ModeratÃ¶r gÃ¼ncelleme hatasÄ±:', error);
                showErrorAlert(error.message);
            }
        }

        // KullanÄ±cÄ±nÄ±n moderatÃ¶r yetkilerini kaldÄ±r
        async function removeUserModerator() {
            const userId = document.getElementById('selected-user-id').value;
            
            if (!confirm('Bu kullanÄ±cÄ±nÄ±n moderatÃ¶r yetkilerini kaldÄ±rmak istediÄŸinizden emin misiniz?')) {
                return;
            }
            
            if (!userId) {
                showErrorAlert('KullanÄ±cÄ± ID bulunamadÄ±');
                return;
            }
            
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_BASE}/admin/remove-moderator`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        userId: userId
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'ModeratÃ¶r kaldÄ±rma baÅŸarÄ±sÄ±z');
                }

                showSuccessAlert('ModeratÃ¶r yetkileri baÅŸarÄ±yla kaldÄ±rÄ±ldÄ±');
                closeUserModal();
                loadUsers(); // KullanÄ±cÄ± listesini yenile
            } catch (error) {
                console.error('ModeratÃ¶r kaldÄ±rma hatasÄ±:', error);
                showErrorAlert(error.message);
            }
        }
    </script>
</body>
</html>
